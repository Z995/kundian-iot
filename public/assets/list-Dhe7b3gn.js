import{r as h,d as n,l as N,o as g,w as t,b as s,f as i,_ as S,u as A,m as B,p as K,a as m,e as V,t as k,c as D,M as C}from"./index-B09Km9Qy.js";import{d as q,g as z}from"./kdDevice-C_HdGTFt.js";const O={__name:"CqkdDeviceSearch",emits:["search"],setup(I,{emit:b}){const a=b,c=h({form:{name:"",device_status:null}}),f=()=>a("search",c.form);function x(){c.form={name:"",device_status:null},a("search",c.form)}return(_,e)=>{const l=n("a-option"),d=n("a-select"),u=n("a-form-item"),p=n("a-input"),r=n("a-button"),w=n("a-form");return g(),N(w,{model:c.form,layout:"inline"},{default:t(()=>[s(u,{label:"设备状态"},{default:t(()=>[s(d,{placeholder:"全部状态","allow-clear":"",class:"w160",modelValue:c.form.device_status,"onUpdate:modelValue":e[0]||(e[0]=y=>c.form.device_status=y)},{default:t(()=>[s(l,{value:1},{default:t(()=>e[2]||(e[2]=[i("在线")])),_:1,__:[2]}),s(l,{value:0},{default:t(()=>e[3]||(e[3]=[i("离线")])),_:1,__:[3]}),s(l,{value:2},{default:t(()=>e[4]||(e[4]=[i("报警")])),_:1,__:[4]})]),_:1},8,["modelValue"])]),_:1}),s(u,{label:"设备名称"},{default:t(()=>[s(p,{placeholder:"请输入设备名称",modelValue:c.form.name,"onUpdate:modelValue":e[1]||(e[1]=y=>c.form.name=y),class:"w200"},null,8,["modelValue"]),s(r,{type:"primary",class:"ml10",onClick:f},{default:t(()=>e[5]||(e[5]=[i("查询")])),_:1,__:[5]}),s(r,{class:"ml10",onClick:x},{default:t(()=>e[6]||(e[6]=[i("重置")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])}}},U={class:"kd-content"},M={key:0,class:"device-status offline"},$={key:1,class:"device-status online"},j={key:2,class:"device-status alarm"},E={class:"f12"},R={class:"f12"},T={class:"f12"},F={class:"f12"},G=Object.assign({name:"DeviceList"},{__name:"list",setup(I){const b=A(),a=h({loading:!1,info:{page:1,limit:10,count:0,list:[]},search:null,selectId:[]});B(()=>{f(a.info.page,a.info.limit)});function c(_){a.search=_,f(1,10)}function f(_,e){a.info.page=_||a.info.page,a.info.limit=e||a.info.limit;let l={page:a.info.page,limit:a.info.limit},d=a.search;d&&(d.name&&(l.name=d.name),d.device_status!==null&&(l.device_status=d.device_status)),a.loading=!0,z(l).then(u=>{var p,r;a.loading=!1,u.code===200&&(a.info.list=((p=u.data)==null?void 0:p.list)||[],a.info.count=((r=u.data)==null?void 0:r.count)||0)}).catch(()=>{a.loading=!1})}function x(_){q({id:_}).then(e=>{if(e.code===200){C.success("删除成功"),f();return}C.error(e.msg)})}return K((_,e)=>{b.setKeepLive("DeviceList",["/device/deviceDetail","/device/deviceAdd"].includes(_.path))}),(_,e)=>{const l=n("a-button"),d=n("router-link"),u=n("a-space"),p=n("a-popconfirm"),r=n("a-table"),w=n("kd-pager"),y=n("a-card"),L=n("kd-page-box");return g(),N(L,null,{default:t(()=>[m("div",U,[s(y,{title:"设备列表",bordered:!1},{extra:t(()=>[s(u,null,{default:t(()=>[s(d,{to:{path:"/device/deviceAdd"}},{default:t(()=>[s(l,{type:"primary"},{default:t(()=>e[1]||(e[1]=[m("i",{class:"ri-add-line"},null,-1),i("新增设备 ")])),_:1,__:[1]})]),_:1}),s(l,{disabled:!a.selectId.length},{default:t(()=>e[2]||(e[2]=[i("批量删除")])),_:1,__:[2]},8,["disabled"])]),_:1})]),default:t(()=>[s(O,{onSearch:c}),s(r,{class:"mt10","row-key":"id",pagination:!1,bordered:!1,data:a.info.list,loading:a.loading,columns:[{title:"设备状态",slotName:"status",width:100},{title:"设备名称",slotName:"name"},{title:"设备编号",slotName:"code"},{title:"网关",slotName:"gateway"},{title:"设备模板",slotName:"template"},{title:"创建时间",dataIndex:"create_time"},{title:"操作",slotName:"action",width:180,fixed:"right"}],"row-selection":{type:"checkbox",showCheckedAll:!0,width:50},selectedKeys:a.selectId,"onUpdate:selectedKeys":e[0]||(e[0]=o=>a.selectId=o),scroll:{x:1200}},{status:t(({record:o})=>[o.status===0?(g(),D("div",M,e[3]||(e[3]=[m("span",{class:"dot"},null,-1),i("离线")]))):o.status===1?(g(),D("div",$,e[4]||(e[4]=[m("span",{class:"dot"},null,-1),i("在线")]))):o.is_warning==1?(g(),D("div",j,e[5]||(e[5]=[m("span",{class:"dot"},null,-1),i("报警")]))):V("",!0)]),name:t(({record:o})=>[m("span",E,k(o.name),1)]),code:t(({record:o})=>[m("span",R,k(o.code),1)]),gateway:t(({record:o})=>{var v;return[m("span",T,k(((v=o.gateway)==null?void 0:v.name)||""),1)]}),template:t(({record:o})=>{var v;return[m("span",F,k(((v=o.template)==null?void 0:v.name)||""),1)]}),action:t(({record:o})=>[s(d,{to:{path:"/device/deviceDetail",query:{id:o.id}}},{default:t(()=>[s(l,{type:"text",size:"mini",class:"ml-10"},{default:t(()=>e[6]||(e[6]=[i("查看")])),_:1,__:[6]})]),_:2},1032,["to"]),s(d,{to:{path:"/device/deviceAdd",query:{id:o.id}}},{default:t(()=>[s(l,{type:"text",size:"mini"},{default:t(()=>e[7]||(e[7]=[i("编辑")])),_:1,__:[7]})]),_:2},1032,["to"]),o.status===0?(g(),N(p,{key:0,content:"确认删除设备吗？",onOk:v=>x(o.id)},{default:t(()=>[s(l,{type:"text",size:"mini"},{default:t(()=>e[8]||(e[8]=[i("删除")])),_:1,__:[8]})]),_:2},1032,["onOk"])):V("",!0)]),_:1},8,["data","loading","selectedKeys"]),s(w,{"page-data":a.info,event:f},null,8,["page-data"])]),_:1})])]),_:1})}}}),P=S(G,[["__scopeId","data-v-7db922c9"]]);export{P as default};
