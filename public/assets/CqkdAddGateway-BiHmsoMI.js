import{C as J}from"./CqkdSelectLabel-BZM80Ztz.js";import{K}from"./index-BYOTr1Yd.js";import{b as O,c as W,a as j,s as P}from"./kdGateway-BVLUjIOd.js";import{_ as Q,i as k,r as $,d as u,c as f,e as p,o as m,b as a,w as t,p as c,F as y,l as V,f as d,t as C,a as w,M}from"./index-whL21Ijk.js";const z={key:0},H={key:0,class:"w400"},X={class:"label-box flex"},Y=["onClick"],Z={__name:"CqkdAddGateway",emits:["success"],setup(h,{expose:L,emit:q}){const G=q,g=k(),v=k(),l=$({show:!1,loading:!1,form:{id:0,marque_id:"",type:0,name:"",mac:"",network:1,locate:1,longitude:"",latitude:"",address:"",label_ids:[]},location:[],label:[]});async function x(s){l.show=!0,l.loading=!0;let e=null;if(s){let n=await O({id:s});n.data&&(e=n.data)}l.form={id:e?e.id:0,marque_id:e?e.marque_id:null,type:e?e.type:0,name:e?e.name:"",mac:e?e.mac:"",network:e?e.network:1,locate:e?e.locate:1,longitude:e?e.longitude:"",latitude:e?e.latitude:"",address:e?e.address:"",label_ids:e&&e.label_ids?e.label_ids.split(","):""},l.form.mac||W().then(n=>{l.form.mac=n.data.mac||""}),l.location=e&&e.latitude&&e.longitude?[e.longitude,e.latitude]:[],l.label=e&&e.label?e.label:[],j({page:1,limit:100}).then(n=>{var r;l.mouldList=((r=n.data)==null?void 0:r.list)||[]}),l.loading=!1}function S(){g.value.show(l.form.label_ids)}function D(s){s&&(l.form.longitude=s.location[0],l.form.latitude=s.location[1],l.form.address=s.address)}function I(s){s&&(l.form.label_ids=s.id,l.label=s.list)}function N(s){l.form.label_ids.splice(s,1),l.label.splice(s,1)}async function U(){if(await v.value.validate())return!1;let e=JSON.parse(JSON.stringify(l.form));e.id||delete e.id,e.label_ids.length&&(e.label_ids=e.label_ids.join(","));let n=await P(e);return n.code===200?(M.success("保存成功"),l.show=!1,G("success"),!0):(M.error(n.msg),!1)}return L({show:x}),(s,e)=>{const n=u("a-input"),r=u("a-form-item"),A=u("a-option"),B=u("a-select"),i=u("a-radio"),b=u("a-radio-group"),T=u("a-button"),E=u("a-form"),R=u("a-spin"),F=u("a-drawer");return l.show?(m(),f("div",z,[a(F,{title:"添加网关",width:800,visible:l.show,"onUpdate:visible":e[6]||(e[6]=o=>l.show=o),"on-before-ok":U},{default:t(()=>[a(R,{loading:l.loading},{default:t(()=>[l.show?(m(),c(E,{key:0,ref_key:"formRef",ref:v,model:l.form,"label-col-props":{flex:"120px"},"wrapper-col-props":{flex:1}},{default:t(()=>[a(r,{label:"网关名称",field:"name",rules:[{required:!0,message:"网关名称必填"}]},{default:t(()=>[a(n,{modelValue:l.form.name,"onUpdate:modelValue":e[0]||(e[0]=o=>l.form.name=o),placeholder:"请输入网关名称",class:"w400"},null,8,["modelValue"])]),_:1}),a(r,{label:"MAC / IMEI",field:"mac",rules:[{required:!0,message:"请输入MAC / IMEI"}]},{default:t(()=>[a(n,{modelValue:l.form.mac,"onUpdate:modelValue":e[1]||(e[1]=o=>l.form.mac=o),placeholder:"请输入MAC / IMEI",class:"w400"},null,8,["modelValue"])]),_:1}),a(r,{label:"网关型号"},{default:t(()=>[a(B,{placeholder:"选择网关型号","allow-clear":"",class:"w400",modelValue:l.form.marque_id,"onUpdate:modelValue":e[2]||(e[2]=o=>l.form.marque_id=o)},{default:t(()=>[(m(!0),f(y,null,V(l.mouldList,(o,_)=>(m(),c(A,{key:_,value:o.id},{default:t(()=>[d(C(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"通讯协议"},{default:t(()=>[a(b,{modelValue:l.form.type,"onUpdate:modelValue":e[3]||(e[3]=o=>l.form.type=o)},{default:t(()=>[a(i,{value:0},{default:t(()=>e[7]||(e[7]=[d("TCP透传")])),_:1,__:[7]}),a(i,{value:1},{default:t(()=>e[8]||(e[8]=[d("WebSocket")])),_:1,__:[8]}),a(i,{value:2},{default:t(()=>e[9]||(e[9]=[d("MQTT标准协议")])),_:1,__:[9]})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"网络类型"},{default:t(()=>[a(b,{modelValue:l.form.network,"onUpdate:modelValue":e[4]||(e[4]=o=>l.form.network=o)},{default:t(()=>[a(i,{value:1},{default:t(()=>e[10]||(e[10]=[d("2G/3G/4G/5G")])),_:1,__:[10]}),a(i,{value:3},{default:t(()=>e[11]||(e[11]=[d("WiFi")])),_:1,__:[11]}),a(i,{value:2},{default:t(()=>e[12]||(e[12]=[d("NB-loT")])),_:1,__:[12]}),a(i,{value:4},{default:t(()=>e[13]||(e[13]=[d("以太网")])),_:1,__:[13]}),a(i,{value:5},{default:t(()=>e[14]||(e[14]=[d("其他")])),_:1,__:[14]})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"定位方式"},{default:t(()=>[a(b,{modelValue:l.form.locate,"onUpdate:modelValue":e[5]||(e[5]=o=>l.form.locate=o)},{default:t(()=>[a(i,{value:1},{default:t(()=>e[15]||(e[15]=[d("手动定位")])),_:1,__:[15]}),a(i,{value:2},{default:t(()=>e[16]||(e[16]=[d("自动定位")])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_:1}),l.form.locate==1?(m(),c(r,{key:0,label:"网关地址"},{default:t(()=>[l.loading?p("",!0):(m(),f("div",H,[a(K,{address:l.form.address,lngLat:l.location,onSuccess:D},null,8,["address","lngLat"])]))]),_:1})):p("",!0),a(r,{label:"标签"},{default:t(()=>[w("div",X,[(m(!0),f(y,null,V(l.label,(o,_)=>(m(),f("div",{class:"label-item",key:_},[d(C(o.name)+" ",1),w("div",{class:"del-icon",onClick:ee=>N(_)},e[17]||(e[17]=[w("i",{class:"ri-close-line"},null,-1)]),8,Y)]))),128)),a(T,{type:"outline",onClick:S},{default:t(()=>e[18]||(e[18]=[d("添加标签")])),_:1,__:[18]})])]),_:1})]),_:1},8,["model"])):p("",!0)]),_:1},8,["loading"]),a(J,{ref_key:"labelRef",ref:g,onSuccess:I},null,512)]),_:1},8,["visible"])])):p("",!0)}}},se=Q(Z,[["__scopeId","data-v-86ddbb4c"]]);export{se as C};
