import{h as E,r as H,_ as T,i as k,j as W,c,o,a as l,k as i,u as e,F as D,l as K,n as m,t as I,m as N,M as S,e as v,b as L,w as q,d as A,p as P}from"./index-3_WCOcxA.js";import{g as F,a as V,s as G,b as O,c as j}from"./kdLive-G86hqvIb.js";import{C as J,a as U}from"./CqkdPlayJessibuca-CxjaCgz4.js";import{c as Q}from"./constantData-DLrCubd0.js";import{p as X}from"./util-S-QMnavk.js";const R=E("gbControl",()=>({state:H({device_id:0,active:1,channel_id:0,preset_id:0,cruse_id:0,presetList:[],cruseList:[],channelList:[],loading:!1,playType:null,device:null,user_device:null,player:null,state:"loading",timer:null,time:10,is_full_screen:!1,url:"",isLoading:!0,h5:{showLoading:!1,player:null}})})),B={basesize:1,viewportWidth:375};function t(b){let f=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(!f)return 0;let s=f/B.viewportWidth;return b*s*B.basesize}const Y={class:"play-control"},Z={class:"control-box flex-cc"},ee={class:"cb-icon"},te={class:"cb-icon"},se={__name:"KdControl",emits:["control"],setup(b,{emit:f}){const s=f,a=k(),h=k(),$=k(),u=k();W(()=>{a.value.style.width=`${t(100)}px`,a.value.style.height=`${t(100)}px`,a.value.style.lineHeight=`${t(100)}px`,h.value.style.width=`${t(100)}px`,h.value.style.height=`${t(100)}px`,h.value.style.lineHeight=`${t(100)}px`,$.value.style.width=`${t(100)}px`,$.value.style.height=`${t(100)}px`,$.value.style.lineHeight=`${t(100)}px`,u.value.style.width=`${t(100)}px`,u.value.style.height=`${t(100)}px`,u.value.style.lineHeight=`${t(100)}px`});function p(x){s("control",x)}return(x,n)=>(o(),c("div",Y,[l("div",{style:i({fontWeight:"bold",fontSize:`${e(t)(14)}px`,marginTop:`${e(t)(38)}px`,marginLeft:`${e(t)(20)}px`})},"云台控制",4),l("div",Z,[l("div",{class:"cb-content",style:i({width:`${e(t)(200)}px`,height:`${e(t)(200)}px`})},[l("div",{ref_key:"cbItem",ref:a,class:"cb-item",onMousedown:n[0]||(n[0]=y=>p("up")),onMouseup:n[1]||(n[1]=y=>p("stop"))},[l("div",{class:"cb-icon arrow-up",style:i({top:`${e(t)(-6)}px`,left:`${e(t)(30)}px`})},[l("div",{class:"ri-arrow-up-s-line",style:i([{color:"#c1bebe"},{fontSize:`${e(t)(28)}px`}])},null,4)],4)],544),l("div",{ref_key:"cbItem1",ref:h,class:"cb-item",onMousedown:n[2]||(n[2]=y=>p("right")),onMouseup:n[3]||(n[3]=y=>p("stop"))},[l("div",{class:"cb-icon",style:i({top:`${e(t)(-10)}px`,left:`${e(t)(38)}px`})},[l("div",{class:"ri-arrow-right-s-line",style:i([{color:"#c1bebe"},{fontSize:`${e(t)(28)}px`}])},null,4)],4)],544),l("div",{ref_key:"cbItem2",ref:$,class:"cb-item",onMousedown:n[4]||(n[4]=y=>p("left")),onMouseup:n[5]||(n[5]=y=>p("stop"))},[l("div",{class:"cb-icon",style:i({top:`${e(t)(1)}px`,left:`${e(t)(29)}px`})},[l("div",{class:"ri-arrow-left-s-line",style:i([{color:"#c1bebe"},{fontSize:`${e(t)(28)}px`}])},null,4)],4)],544),l("div",{ref_key:"cbItem3",ref:u,class:"cb-item",onMousedown:n[6]||(n[6]=y=>p("down")),onMouseup:n[7]||(n[7]=y=>p("stop"))},[l("div",{class:"cb-icon",style:i({top:`${e(t)(6)}px`,left:`${e(t)(41)}px`})},[l("div",{class:"ri-arrow-down-s-line",style:i([{color:"#c1bebe"},{fontSize:`${e(t)(28)}px`}])},null,4)],4)],544),l("div",{class:"cb-center",style:i({width:`${e(t)(100)}px`,height:`${e(t)(100)}px`,left:`${e(t)(50)}px`,top:`${e(t)(50)}px`})},[l("div",{class:"cbc-item",style:i({width:"100%",height:`${e(t)(50)}px`,lineHeight:`${e(t)(50)}px`}),onMousedown:n[8]||(n[8]=y=>p("zoomin")),onMouseup:n[9]||(n[9]=y=>p("stop"))},[l("div",ee,[l("div",{class:"ri-add-line",style:i([{color:"#c1bebe"},{fontSize:`${e(t)(18)}px`}])},null,4)])],36),l("div",{class:"cbc-item",style:i({width:"100%",height:`${e(t)(50)}px`,lineHeight:`${e(t)(50)}px`}),onMousedown:n[10]||(n[10]=y=>p("zoomout")),onMouseup:n[11]||(n[11]=y=>p("stop"))},[l("div",te,[l("div",{class:"ri-subtract-line",style:i([{color:"#c1bebe"},{fontSize:`${e(t)(18)}px`}])},null,4)])],36)],4)],4)])]))}},ie=T(se,[["__scopeId","data-v-fe473057"]]),le={class:"flex-cb channel-box mt10"},ne=["onClick"],ae={__name:"KdChannel",emits:["change"],setup(b,{emit:f}){const s=R(),a=f;h();function h(){F({id:s.state.device.id}).then(u=>{var p;(p=u.data)!=null&&p.items.length&&(s.state.channelList=u.data.items,s.state.channel_id=s.state.channelList[0].channelId)})}function $(u){s.state.channel_id=u.channelId,a("change")}return(u,p)=>(o(),c("div",null,[l("div",{class:"fb",style:i({fontSize:`${e(t)(14)}px`,marginLeft:`${e(t)(20)}px`,marginTop:`${e(t)(20)}px`})},"设备通道",4),l("div",le,[(o(!0),c(D,null,K(e(s).state.channelList,(x,n)=>(o(),c("div",{class:m(["channel-item",{active:e(s).state.channel_id===x.channelId}]),style:i({height:`${e(t)(86)}px`,marginBottom:`${e(t)(12)}px`,padding:`${e(t)(10)}px`,borderRadius:`${e(t)(10)}px`}),key:n,onClick:y=>$(x)},[l("div",{class:"name",style:i({fontSize:`${e(t)(14)}px`})},I(x.name),5),l("div",{class:"desc mt5",style:i({fontSize:`${e(t)(12)}px`})},I(x.channelId),5),x.state=="online"?(o(),c("div",{key:0,class:"tag online",style:i({fontSize:`${e(t)(10)}px`,bottom:`${e(t)(10)}px`,left:`${e(t)(10)}px`})},"在线",4)):(o(),c("div",{key:1,class:"tag",style:i({fontSize:`${e(t)(10)}px`,bottom:`${e(t)(10)}px`,left:`${e(t)(10)}px`})},"离线",4))],14,ne))),128))])]))}},oe=T(ae,[["__scopeId","data-v-71f20469"]]),re={key:0},de={class:"play-box"},ce={class:"play-box-div",id:"playBoxdiv"},pe={key:0,class:"pv-status"},ve={__name:"wxlive",setup(b){const f=N().query,s=R();f&&f.token&&localStorage.setItem("_IOT_TOKEN_",f.token);const a=H({loading:!1,flowStatus:!1,errorCode:null});W(()=>{s.state.device_id=f.id,h()});async function h(){let d=await V({id:f.id});s.state.device=d.data,d.data.related_type=="local"?s.state.user_device=d.data.hls:s.state.user_device=d.data.details.device.webrtc,s.state.device.hls&&(s.state.playType=1),s.state.device.flv&&(s.state.playType=2),(s.state.device.webrtc||s.state.details.device)&&(s.state.playType=3),s.state.playType==3&&u()}function $(d){p(),s.state.playType=d,d==3&&u()}function u(){let{channel_id:d,device:r,user_device:C,channelList:_}=s.state,g={id:r.id};d&&(g.channels=d);let M=C;if(r.details.device.type===2){if(!monitorState.state.channel_id)return S.warning("请先选择通道");_.forEach(w=>{w.gbId===d&&(M=w.webrtc)})}a.loading=!0,G(g).then(w=>{if(w.code!==200){S.error(w.msg),a.loading=!1;return}setTimeout(function(){X({el:"playBoxdiv",webrtc:M},z=>{a.loading=!1,s.state.player=z,a.flowStatus=!0,a.errorCode=null},z=>{a.loading=!1,a.errorCode=z.code})},1e3)}).catch(()=>{a.loading=!1})}function p(){if(!s.state.player)return!1;x();let d={id:monitorState.state.live_id};monitorState.state.channel_id&&(d.channels=a.play_channel),O(d).then(r=>{if(a.flowStatus=!1,r.code===200){S.success("已停止拉流");return}S.error(r.msg)})}function x(){s.state.player&&(s.state.player.stop(),s.state.player.release(),s.state.player=null,a.errorCode=null)}function n(d){s.state.active=d}function y(d){let r={id:s.state.device_id,cmd:d,speed:5};j(r)}return(d,r)=>{var _;const C=A("a-spin");return e(s).state.device?(o(),c("div",re,[l("div",{style:i({width:"100%",height:`${e(t)(240)}px`,position:"relative",background:"#000"})},[e(s).state.playType==1?(o(),c("div",{key:0,style:i({width:"100%",height:`${e(t)(240)}px`,background:"#000",zIndex:"9"})},[L(J,{id:"localLiveM3u8Box",src:e(s).state.device.hls},null,8,["src"])],4)):v("",!0),e(s).state.playType==2?(o(),c("div",{key:1,style:i({width:"100%",height:`${e(t)(240)}px`,background:"#000",zIndex:"9"})},[L(U,{id:"localLiveFlvBox",src:e(s).state.device.flv},null,8,["src"])],4)):v("",!0),e(s).state.playType==3?(o(),c("div",{key:2,style:i({width:"100%",height:`${e(t)(240)}px`,background:"#000",zIndex:"9"})},[l("div",de,[L(C,{loading:a.loading,style:{width:"100%",height:"100%"},tip:"监控加载中..."},{default:q(()=>[l("div",ce,[!a.loading&&!a.flowStatus?(o(),c("div",pe,"离线")):v("",!0),a.errorCode?(o(),c("div",{key:1,class:"pv-status pv-error",style:i({fontSize:`${e(t)(16)}px`})},I(e(Q).qiuNiuSdkError[a.errorCode]),5)):v("",!0)])]),_:1},8,["loading"])])],4)):v("",!0)],4),e(s).state.device.related_type!=="local"?(o(),c("div",{key:0,class:"device-option",style:i({height:`${e(t)(60)}px`})},[l("div",{class:m(["option-item",{active:e(s).state.active==1}]),style:i({height:`${e(t)(60)}px`,width:`${e(t)(100)}px`}),onClick:r[0]||(r[0]=g=>n(1))},[l("div",{style:i({fontSize:`${e(t)(14)}px`})},"云台控制",4)],6),((_=e(s).state.device.details.device)==null?void 0:_.type)==2?(o(),c("div",{key:0,class:m(["option-item",{active:e(s).state.active==2}]),style:i({height:`${e(t)(60)}px`,width:`${e(t)(100)}px`}),onClick:r[1]||(r[1]=g=>n(2))},[l("div",{style:i({fontSize:`${e(t)(14)}px`})},"通道",4)],6)):v("",!0)],4)):v("",!0),e(s).state.active==1&&e(s).state.playType!==null?(o(),c("div",{key:1,class:"flex-c",style:i({width:"94%",padding:`${e(t)(5)}px`,marginLeft:"3%",marginTop:`${e(t)(20)}px`,border:"1px solid #eee"})},[e(s).state.device.hls?(o(),c("div",{key:0,class:m(["mr20",e(s).state.playType==1?"active":""]),style:i({width:`${e(t)(110)}px`,height:`${e(t)(26)}px`,lineHeight:`${e(t)(26)}px`,textAlign:"center",fontSize:`${e(t)(15)}px`,cursor:"pointer",borderRadius:`${e(t)(10)}px`}),onClick:r[2]||(r[2]=g=>$(1))},"M3U8",6)):v("",!0),e(s).state.device.flv?(o(),c("div",{key:1,class:m(["mr20",e(s).state.playType==2?"active":""]),style:i({width:`${e(t)(110)}px`,height:`${e(t)(26)}px`,lineHeight:`${e(t)(26)}px`,textAlign:"center",fontSize:`${e(t)(15)}px`,cursor:"pointer",borderRadius:`${e(t)(10)}px`}),onClick:r[3]||(r[3]=g=>$(2))},"FLV",6)):v("",!0),e(s).state.device.webrtc?(o(),c("div",{key:2,class:m(["",e(s).state.playType==3?"active":""]),style:i({width:`${e(t)(110)}px`,height:`${e(t)(26)}px`,lineHeight:`${e(t)(26)}px`,textAlign:"center",fontSize:`${e(t)(15)}px`,cursor:"pointer",borderRadius:`${e(t)(10)}px`}),onClick:r[4]||(r[4]=g=>$(3))},"WebRTC",6)):v("",!0)],4)):v("",!0),e(s).state.device.related_type!=="local"?(o(),c(D,{key:2},[e(s).state.active==1?(o(),P(ie,{key:0,onControl:y})):v("",!0),e(s).state.active==2?(o(),P(oe,{key:1,onChange:r[5]||(r[5]=g=>u())})):v("",!0)],64)):v("",!0)])):v("",!0)}}},he=T(ve,[["__scopeId","data-v-2518f559"]]);export{he as default};
