import{u as ee,f as le,a as se,b as ie}from"./kdDevice-tpIu9Cvi.js";import{i as te,r as E,d as _,c as n,e as V,o as i,b as d,w as c,M as D,_ as ae,p as q,a,F as B,l as j,t as f,A as oe,m as de,B as ne,j as re,f as g,n as Y,u as ce}from"./index-3_WCOcxA.js";import{K as ue}from"./KdMarkerAddress-DQVdprfo.js";import{a as Z,C as _e}from"./CqkdPlayJessibuca-CxjaCgz4.js";import{a as ve,g as pe}from"./kdLive-G86hqvIb.js";import{c as fe}from"./constantData-DLrCubd0.js";import"./TianDiMap-3SN5_Mvs.js";const me="/static/img/device/device-model.png",ye={key:0},ke={__name:"CqkdUpdateDataValue",emits:["success"],setup(T,{expose:C,emit:r}){const h=te(),t=r,u=E({show:!1,value:"",variable_id:""});function x(v){u.show=!0,u.value=v.value,u.variable_id=v.id}async function l(){if(await h.value.validate())return!1;let m={variable_id:u.variable_id,value:u.value},y=await ee(m);return y.code===200?(D.success("变量值修改成功"),t("success"),!0):(D.error(y.msg),!1)}return C({show:x}),(v,m)=>{const y=_("a-input"),s=_("a-form-item"),e=_("a-form"),p=_("a-modal");return u.show?(i(),n("div",ye,[d(p,{visible:u.show,"onUpdate:visible":m[1]||(m[1]=k=>u.show=k),width:"500px",title:"修改变量值","on-before-ok":l},{default:c(()=>[d(e,{ref_key:"formRef",ref:h,model:u,"label-col-props":{flex:"100px"},"wrapper-col-props":{flex:1}},{default:c(()=>[d(s,{label:"变量值",rules:[{required:!0,message:"请输入变量值"}]},{default:c(()=>[d(y,{modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=k=>u.value=k),placeholder:"请输入变量值"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])):V("",!0)}}},be="/static/img/wxapp/player_loading.png",ge={class:"device-live"},he={class:"live-box flex"},xe={class:"live-item"},we={key:0,class:"offline-status"},Ve={key:1,class:"playing-show"},$e=["onClick"],Ce={key:0,class:"offline-status"},De={key:1,class:"play-ing"},Le={key:2,class:"playing-show"},Ue={key:3,class:"offline-status"},qe=["onClick"],Be={class:"name"},Ie={key:0},Ne={key:1},Me={__name:"CqkdDeviceLive",props:{list:{type:Array,default:[]}},setup(T){const C=T,r=E({player:{}});async function h(t){var u,x,l,v,m,y;if(!r.player[t.id]&&(t.related_type==="local"&&(r.player[t.id]={play:!0}),t.related_type==="kun_dian")){r.player[t.id]={play:!0,loading:!0,live:null,error:"",src:""};let s=await ve({id:t.id});if(s.code===200){if(r.player[t.id].live=s.data,((x=(u=s.data)==null?void 0:u.details)==null?void 0:x.device.type)===2){let e=await pe({id:t.id});e.code===200&&((l=e.data)!=null&&l.items.length)&&(r.player[t.id].src=(v=e.data)==null?void 0:v.items[0].flv)}r.player[t.id].src||(r.player[t.id].src=(y=(m=s.data)==null?void 0:m.details)==null?void 0:y.device.flv),r.player[t.id].loading=!1}else r.player[t.id].error=s.msg,r.player[t.id].loading=!1}}return(t,u)=>{const x=_("kd-empty");return i(),n("div",ge,[C.list.length?V("",!0):(i(),q(x,{key:0,height:400,title:"暂无绑定的监控"})),a("div",he,[(i(!0),n(B,null,j(C.list,(l,v)=>{var m,y,s,e,p,k,w,I,N,M,S,F,z,A,L,K,R,b;return i(),n("div",{class:"live-item-box",key:v},[a("div",xe,[l.related_type==="local"?(i(),n(B,{key:0},[!l.flv&&!l.hls?(i(),n("div",we,"暂无播放源")):(y=(m=r.player)==null?void 0:m[l.id])!=null&&y.play?(i(),n("div",Ve,[l.flv?(i(),q(Z,{key:0,id:"localLiveFlvBox_"+l.id,src:l.flv},null,8,["id","src"])):(i(),q(_e,{key:1,autoplay:!0,id:"localLiveM3u8Box_"+l.id,src:l.hls},null,8,["id","src"]))])):(i(),n("div",{key:2,class:"play-icon",onClick:O=>h(l)},u[0]||(u[0]=[a("i",{class:"ri-play-fill"},null,-1)]),8,$e))],64)):V("",!0),l.related_type==="kun_dian"?(i(),n(B,{key:1},[l.state!=="online"?(i(),n("div",Ce,"离线")):(e=(s=r.player)==null?void 0:s[l.id])!=null&&e.play&&((k=(p=r.player)==null?void 0:p[l.id])!=null&&k.loading)?(i(),n("div",De,u[1]||(u[1]=[a("img",{class:"loading-icon",src:be,alt:""},null,-1),a("div",{class:"loading-txt"},"监控加载中...",-1)]))):!((I=(w=r.player)==null?void 0:w[l.id])!=null&&I.loading)&&((M=(N=r.player)==null?void 0:N[l.id])!=null&&M.src)?(i(),n("div",Le,[d(Z,{id:"localLiveFlvBox_"+l.id,src:(F=(S=r.player)==null?void 0:S[l.id])==null?void 0:F.src},null,8,["id","src"])])):!((A=(z=r.player)==null?void 0:z[l.id])!=null&&A.loading)&&((K=(L=r.player)==null?void 0:L[l.id])!=null&&K.error)?(i(),n("div",Ue,f((b=(R=r.player)==null?void 0:R[l.id])==null?void 0:b.error),1)):(i(),n("div",{key:4,class:"play-icon",onClick:O=>h(l)},u[2]||(u[2]=[a("i",{class:"ri-play-fill"},null,-1)]),8,qe))],64)):V("",!0)]),a("div",Be,[l.related_type==="local"?(i(),n("span",Ie,f(l.name),1)):V("",!0),l.related_type==="kun_dian"?(i(),n("span",Ne,f(l.desc||l.name),1)):V("",!0)])])}),128))])])}}},Se=ae(Me,[["__scopeId","data-v-23015382"]]),Fe={class:"kd-content"},ze={class:"device-basic flex"},Ae={class:"device-basic-left flex mt5"},Ke={class:"db-info"},Re={class:"db-info-name fb"},Oe={class:"db-info-num mt10"},Pe={class:"db-info-desc"},Te={class:"db-info-desc-item flex"},je={class:"db-value"},Ee={class:"db-info-desc-item flex"},Je={class:"db-value"},Ge={class:"db-info-desc-item flex"},He={class:"db-value"},Qe={class:"db-info-desc-item flex"},We={class:"db-value"},Xe={class:"tag-box flex"},Ye={class:"db-info-desc-item flex"},Ze={class:"db-value"},et={key:0,class:"desc-map mt5"},tt={class:"device-data"},at={class:"dd-slave flex mt10 mb10"},lt=["onClick"],st={key:0},it={key:1},ot={class:"data-value"},dt={key:0},nt={key:1},rt=["onClick"],ct={key:0},ut={__name:"deviceDetail",setup(T){const C=oe(),r=de().query,h=te(),t=E({loading:!1,active:"detail",slave_id:0,slaveList:[],data:{loading:!1,list:[],search:{name:"",type:null}}});ne(()=>C.state.collectInfo,s=>{for(var e=0;e<t.data.list.length;e++)if(t.data.list[e].id===s.data.variable_id){t.data.list[e].value=s.data.value+"",t.data.list[e].update_time=s.data.date;break}}),re(async()=>{t.loading=!0,await u(),await v(0)});async function u(){let s=await le({id:r.id});t.loading=!1,s.code===200&&(t.info=s.data,t.slaveList=t.info.subordinate)}const x=s=>h.value.show({id:s.id,value:s.value});function l(s){ie({variable_id:s}).then(e=>{if(e.code===200){D.success("采集成功"),v(t.slave_id);return}D.error(e.msg)})}function v(s){t.slave_id=s,t.data.loading=!0;let{name:e,type:p}=t.data.search,k=s?{subordinate_id:s}:{device_id:r.id};e&&(k.name=e),p&&(k.type=p),se(k).then(w=>{t.data.loading=!1,t.data.list=w.data.list}).catch(()=>{t.data.loading=!1})}function m(){t.data.search={name:"",type:null},v(t.slave_id)}function y(s){let e={variable_id:s.id,value:s.value};ee(e).then(p=>{if(p.code===200){D.success("变量值修改成功");return}D.error(p.msg)})}return(s,e)=>{const p=_("a-button"),k=_("a-tag"),w=_("a-option"),I=_("a-select"),N=_("a-input"),M=_("a-space"),S=_("a-switch"),F=_("router-link"),z=_("a-popconfirm"),A=_("a-table"),L=_("a-tab-pane"),K=_("a-tabs"),R=_("kd-page-box");return i(),q(R,{loading:t.loading},{default:c(()=>[a("div",Fe,[d(K,{"active-key":t.active,"onUpdate:activeKey":e[5]||(e[5]=b=>t.active=b)},{extra:c(()=>[d(p,{onClick:e[0]||(e[0]=b=>s.$router.go(-1))},{default:c(()=>e[7]||(e[7]=[g("返回")])),_:1,__:[7]})]),default:c(()=>[d(L,{key:"detail",title:"设备详情"},{default:c(()=>{var b,O,J,G,H,Q,W,X;return[a("div",ze,[a("div",null,[e[14]||(e[14]=a("div",{class:"fb"},"设备信息",-1)),a("div",Ae,[e[13]||(e[13]=a("img",{src:me,alt:"",class:"gateway-icon"},null,-1)),a("div",Ke,[a("div",Re,f((b=t.info)==null?void 0:b.name),1),a("div",Oe,f((O=t.info)==null?void 0:O.code),1),a("div",Pe,[a("div",Te,[e[8]||(e[8]=a("div",{class:"db-title"},"设备模板：",-1)),a("div",je,f(((G=(J=t.info)==null?void 0:J.template)==null?void 0:G.name)||"-"),1)]),a("div",Ee,[e[9]||(e[9]=a("div",{class:"db-title"},"设备网关：",-1)),a("div",Je,f(((H=t.info)==null?void 0:H.gateway)||"-"),1)]),a("div",Ge,[e[10]||(e[10]=a("div",{class:"db-title"},"设备地址：",-1)),a("div",He,f(((Q=t.info)==null?void 0:Q.address)||"-"),1)]),a("div",Qe,[e[11]||(e[11]=a("div",{class:"db-title"},"设备标签：",-1)),a("div",We,[a("div",Xe,[(i(!0),n(B,null,j((W=t.info)==null?void 0:W.label,(o,$)=>(i(),q(k,{color:"blue",key:$},{default:c(()=>[g(f(o.name),1)]),_:2},1024))),128))])])]),a("div",Ye,[e[12]||(e[12]=a("div",{class:"db-title"},"设备描述：",-1)),a("div",Ze,f(((X=t.info)==null?void 0:X.describe)||"-"),1)])])])])]),a("div",null,[e[15]||(e[15]=a("div",{class:"fb"},"设备地图",-1)),t.info?(i(),n("div",et,[d(ue,{longitude:t.info.longitude,latitude:t.info.latitude},null,8,["longitude","latitude"])])):V("",!0)])]),a("div",tt,[e[23]||(e[23]=a("div",{class:"fb"},"变量概况",-1)),a("div",at,[a("div",{class:Y(["dd-slave-item",{active:t.slave_id===0}]),onClick:e[1]||(e[1]=o=>v(0))}," 全部 ",2),(i(!0),n(B,null,j(t.slaveList,(o,$)=>{var U;return i(),n("div",{class:Y(["dd-slave-item",{active:t.slave_id===o.id}]),key:$,onClick:P=>v(o.id)},f((U=o.subordinate)==null?void 0:U.name),11,lt)}),128))]),d(M,null,{default:c(()=>[d(I,{placeholder:"全部变量","allow-clear":"",class:"w160",modelValue:t.data.search.type,"onUpdate:modelValue":e[2]||(e[2]=o=>t.data.search.type=o)},{default:c(()=>[d(w,{value:1},{default:c(()=>e[16]||(e[16]=[g("直采变量")])),_:1,__:[16]}),d(w,{value:2},{default:c(()=>e[17]||(e[17]=[g("运算型变量")])),_:1,__:[17]}),d(w,{value:3},{default:c(()=>e[18]||(e[18]=[g("录入型变量")])),_:1,__:[18]})]),_:1},8,["modelValue"]),d(N,{placeholder:"请输入变量名称",modelValue:t.data.search.name,"onUpdate:modelValue":e[3]||(e[3]=o=>t.data.search.name=o),class:"w240"},null,8,["modelValue"]),d(p,{type:"primary",onClick:e[4]||(e[4]=o=>v(t.slave_id))},{default:c(()=>e[19]||(e[19]=[g("查询")])),_:1,__:[19]}),d(p,{onClick:m},{default:c(()=>e[20]||(e[20]=[g("重置")])),_:1,__:[20]})]),_:1}),d(A,{class:"kd-small-table mt10",bordered:!1,"row-key":"id",data:t.data.list,columns:[{title:"变量ID",dataIndex:"id"},{title:"变量名称",dataIndex:"name"},{title:"变量类型",slotName:"type"},{title:"更新时间",dataIndex:"update_time"},{title:"当前值",slotName:"value"},{title:"操作",slotName:"action",width:200}],loading:t.data.loading},{type:c(({record:o})=>[g(f(ce(fe).dataType[o.type]),1)]),value:c(({record:o})=>{var $,U;return[o.templateVariable.data_format===33?(i(),n("div",st,[d(S,{modelValue:o.value,"onUpdate:modelValue":P=>o.value=P,"checked-value":"1","unchecked-value":"0",onChange:P=>y(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):(i(),n("div",it,[a("div",ot,[o.templateVariable.read_write_mode===1?(i(),n("span",dt,f(o.value)+" "+f(($=o.templateVariable)==null?void 0:$.unit),1)):(i(),n("span",nt,[g(f(o.value)+f((U=o.templateVariable)==null?void 0:U.unit)+" ",1),a("i",{class:"ri-edit-line kd-link f20 ml5",onClick:P=>x(o)},null,8,rt)]))])]))]}),action:c(({record:o})=>[d(F,{to:{path:"/statistics/history",query:{id:o.id,device_id:o.device_id,slave_id:o.subordinate_id}}},{default:c(()=>[d(p,{type:"text",size:"mini",class:"ml-10"},{default:c(()=>e[21]||(e[21]=[g("历史查询")])),_:1,__:[21]})]),_:2},1032,["to"]),d(z,{content:"您将主动采集变量，是否继续?",onOk:$=>l(o.id)},{default:c(()=>[d(p,{type:"text",size:"mini"},{default:c(()=>e[22]||(e[22]=[g("主动采集")])),_:1,__:[22]})]),_:2},1032,["onOk"])]),_:1},8,["data","loading"])])]}),_:1}),d(L,{key:"live",title:"视频监控"},{default:c(()=>{var b;return[t.active==="live"?(i(),n("div",ct,[d(Se,{list:(b=t.info)==null?void 0:b.monitor},null,8,["list"])])):V("",!0)]}),_:1})]),_:1},8,["active-key"])]),d(ke,{ref_key:"updateValue",ref:h,onSuccess:e[6]||(e[6]=b=>v(t.slave_id))},null,512)]),_:1},8,["loading"])}}},bt=ae(ut,[["__scopeId","data-v-82339dde"]]);export{bt as default};
