import{s as $,i as V,r as N,d as r,c as R,e as C,o as x,b as o,w as n,p as y,M as g,j as J,a as I,f as w}from"./index-whL21Ijk.js";const U="/admin/user/";function L(c){return $({url:`${U}getAdminList`,method:"get",params:c})}function D(c){return $({url:`${U}saveAdmin`,method:"post",data:c})}function z(c){return $({url:`${U}delAdmin`,method:"post",data:c})}const M={key:0},F={__name:"KdAccountAdd",emits:["success"],setup(c,{expose:v,emit:k}){const e=k,f=V(),l=N({show:!1,form:{id:0,name:"",phone:"",password:"",status:1}});function i(s){l.show=!0,l.form={id:s?s.id:0,name:s?s.name:"",phone:s?s.phone:"",password:"",status:s?parseInt(s.status):1}}async function u(){if(await f.value.validate())return!1;let a=JSON.parse(JSON.stringify(l.form));a.id||delete a.id;let t=await D(a);return t.code===200?(g.success("保存成功"),e("success"),!0):(g.error(t.msg),!1)}return v({show:i}),(s,a)=>{const t=r("a-input"),d=r("a-form-item"),m=r("a-switch"),h=r("a-form"),b=r("a-drawer");return l.show?(x(),R("div",M,[o(b,{title:"新增用户",visible:l.show,"onUpdate:visible":a[4]||(a[4]=p=>l.show=p),"on-before-ok":u,width:"800px"},{default:n(()=>[o(h,{model:l.form,ref_key:"formRef",ref:f,"label-col-props":{flex:"120px"},"wrapper-col-props":{flex:1}},{default:n(()=>[o(d,{label:"用户名",field:"name",rules:[{required:!0,message:"用户名必填"}]},{default:n(()=>[o(t,{modelValue:l.form.name,"onUpdate:modelValue":a[0]||(a[0]=p=>l.form.name=p),placeholder:"请输入用户名",class:"w500"},null,8,["modelValue"])]),_:1}),o(d,{label:"登录账号",field:"phone",rules:[{required:!0,message:"登录账号必填"}]},{default:n(()=>[o(t,{modelValue:l.form.phone,"onUpdate:modelValue":a[1]||(a[1]=p=>l.form.phone=p),placeholder:"请输入登录账号/手机号",class:"w500"},null,8,["modelValue"])]),_:1}),l.form.id?C("",!0):(x(),y(d,{key:0,label:"登陆密码",field:"password",rules:[{required:!0,message:"登陆密码必填"}]},{default:n(()=>[o(t,{modelValue:l.form.password,"onUpdate:modelValue":a[2]||(a[2]=p=>l.form.password=p),placeholder:"请输入登陆密码",class:"w500"},null,8,["modelValue"])]),_:1})),o(d,{label:"状态"},{default:n(()=>[o(m,{modelValue:l.form.status,"onUpdate:modelValue":a[3]||(a[3]=p=>l.form.status=p),"checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])):C("",!0)}}},K={key:0},P={__name:"KdUpdateLoginPwd",setup(c,{expose:v}){const k=V(),e=N({show:!1,form:{id:0,name:"",phone:"",password:"",re_pwd:"",status:1}});function f(i){if(!i)return g.warning("暂无用户数据"),!1;e.form={id:i?i.id:0,name:i?i.name:"",phone:i?i.phone:"",password:"",re_pwd:"",status:i?parseInt(i.status):1},e.show=!0}async function l(){if(await k.value.validate())return!1;let u=JSON.parse(JSON.stringify(e.form));if(u.password!==u.re_pwd)return g.warning("两次密码输入不一致"),!1;delete u.re_pwd;let s=await D(u);return s.code===200?(g.success("密码修改成功"),!0):(g.error(s.msg),!1)}return v({show:f}),(i,u)=>{const s=r("a-input"),a=r("a-form-item"),t=r("a-form"),d=r("a-modal");return e.show?(x(),R("div",K,[o(d,{title:"修改登录密码",visible:e.show,"onUpdate:visible":u[2]||(u[2]=m=>e.show=m),width:"500px","on-before-ok":l},{default:n(()=>[o(t,{model:e.form,ref_key:"formRef",ref:k,"label-col-props":{flex:"140px"},"wrapper-col-props":{flex:1}},{default:n(()=>[o(a,{label:"新密码",field:"password",rules:[{required:!0,message:"新密码必填"}]},{default:n(()=>[o(s,{modelValue:e.form.password,"onUpdate:modelValue":u[0]||(u[0]=m=>e.form.password=m),type:"password",placeholder:"请输入新密码",class:"w500"},null,8,["modelValue"])]),_:1}),o(a,{label:"再次输入新密码",field:"re_pwd",rules:[{required:!0,message:"新密码必填"}]},{default:n(()=>[o(s,{modelValue:e.form.re_pwd,"onUpdate:modelValue":u[1]||(u[1]=m=>e.form.re_pwd=m),type:"password",placeholder:"请再次输入新密码",class:"w500"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])):C("",!0)}}},j={class:"kd-content"},T={__name:"list",setup(c){const v=V(),k=V(),e=N({loading:!1,search:{name:""},info:{list:[],page:1,limit:10,count:0}});J(()=>{f(1,10)});function f(a,t){e.info.page=a||e.info.page,e.info.limit=t||e.info.limit;let d={page:e.info.page,limit:e.info.limit};e.search.name&&(d.key=e.search.name),e.loading=!0,L(d).then(m=>{e.loading=!1,e.info.list=m.data.list,e.info.count=m.data.count}).catch(()=>{e.loading=!1})}function l(a){v.value.show(a)}const i=a=>k.value.show(a);function u(){e.search={},f(1,e.info.limit)}function s(a){z({id:a}).then(t=>{if(t.code===200){g.success("删除成功"),f();return}g.error(t.msg)})}return(a,t)=>{const d=r("a-button"),m=r("a-input"),h=r("a-space"),b=r("a-tag"),p=r("a-popconfirm"),O=r("a-table"),q=r("kd-pager"),S=r("a-card"),B=r("kd-page-box");return x(),y(B,null,{default:n(()=>[I("div",j,[o(S,{title:"用户列表",bordered:!1},{extra:n(()=>[o(d,{type:"primary",onClick:t[0]||(t[0]=_=>l(null))},{default:n(()=>t[3]||(t[3]=[I("i",{class:"ri-add-line"},null,-1),w("添加用户 ")])),_:1,__:[3]})]),default:n(()=>[o(h,null,{default:n(()=>[o(m,{modelValue:e.search.name,"onUpdate:modelValue":t[1]||(t[1]=_=>e.search.name=_),placeholder:"用户姓名，手机号或登录账户",class:"w300"},null,8,["modelValue"]),o(d,{type:"primary",loading:e.loading,onClick:t[2]||(t[2]=_=>f(1,e.info.limit))},{default:n(()=>t[4]||(t[4]=[w("查询")])),_:1,__:[4]},8,["loading"]),o(d,{onClick:u},{default:n(()=>t[5]||(t[5]=[w("重置")])),_:1,__:[5]})]),_:1}),o(O,{class:"kd-small-table mt20",pagination:!1,"row-key":"id",data:e.info.list,loading:e.loading,bordered:!1,columns:[{title:"ID",dataIndex:"id",width:80},{title:"用户姓名",dataIndex:"name"},{title:"登录账号",dataIndex:"phone"},{title:"设备数量",dataIndex:"device_count"},{title:"网关数量",dataIndex:"gateway_count"},{title:"状态",slotName:"status"},{title:"注册时间",dataIndex:"create_time"},{title:"操作",slotName:"action",width:190}]},{status:n(({record:_})=>[_.status==1?(x(),y(b,{key:0,color:"#00CC66"},{default:n(()=>t[6]||(t[6]=[w("启用")])),_:1,__:[6]})):(x(),y(b,{key:1,color:"#FF9933"},{default:n(()=>t[7]||(t[7]=[w("禁用")])),_:1,__:[7]}))]),action:n(({record:_})=>[o(d,{type:"text",size:"mini",class:"ml-10",onClick:A=>l(_)},{default:n(()=>t[8]||(t[8]=[w("编辑")])),_:2,__:[8]},1032,["onClick"]),o(d,{type:"text",size:"mini",class:"ml-10",onClick:A=>i(_)},{default:n(()=>t[9]||(t[9]=[w("修改密码")])),_:2,__:[9]},1032,["onClick"]),o(p,{content:"确认删除用户吗?",onOk:A=>s(_.id)},{default:n(()=>[o(d,{type:"text",size:"mini"},{default:n(()=>t[10]||(t[10]=[w("删除")])),_:1,__:[10]})]),_:2},1032,["onOk"])]),_:1},8,["data","loading"]),o(q,{"page-data":e.info,event:f},null,8,["page-data"])]),_:1})]),o(F,{ref_key:"addRef",ref:v,onSuccess:f},null,512),o(P,{ref_key:"pwdRef",ref:k},null,512)]),_:1})}}};export{T as default};
