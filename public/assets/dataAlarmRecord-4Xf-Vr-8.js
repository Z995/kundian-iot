import{_ as D}from"./KdAlarmRecordSearch-DCTmg5Gi.js";import{h as A,i as B,j as O}from"./kdStatistics-Ct4QjyK5.js";import{_ as R,r as S,j as V,p,w as n,d as r,o as s,a as f,b as l,f as u,e as h,c as _,t as C,M as g}from"./index-whL21Ijk.js";import"./kdDevice-DVsktYij.js";const M={class:"kd-content"},$={key:0},j={key:0},z={class:"trigger-con"},E={key:1},L={key:0,class:"normal"},T={key:1,class:"warning"},q={key:0},F={key:1},G={__name:"dataAlarmRecord",setup(H){const t=S({loading:!1,search:{},info:{page:1,limit:10,count:0,list:[]},selectId:[]});V(()=>{c(1,10)});function k(d){t.search=d,c(1,t.info.limit)}function c(d,i){t.info.page=d||t.info.page,t.info.limit=i||t.info.limit;let o={page:t.info.page,limit:t.info.limit},e=t.search;e.device_id&&(o.device_id=e.device_id),e.variable_id&&(o.variable_id=e.variable_id),[0,1].includes(e.is_warning)&&(o.is_warning=e.is_warning),[0,1].includes(e.status)&&(o.status=e.status),e.time&&e.time.length&&(o.start_time=e.time[0],o.end_time=e.time[1]),t.loading=!0,A(o).then(m=>{t.loading=!1,t.info.list=m.data.list||[],t.info.count=m.data.count||0}).catch(()=>{t.loading=!1})}function v(d){O({id:d}).then(i=>{if(i.code===200){g.success("处理成功"),c();return}g.error(i.msg)})}function x(d){B({id:d}).then(i=>{if(i.code===200){g.success("删除成功"),c();return}g.error(i.msg)})}return(d,i)=>{const o=r("a-tooltip"),e=r("a-button"),m=r("a-popconfirm"),b=r("a-table"),y=r("kd-pager"),w=r("a-card"),I=r("kd-page-box");return s(),p(I,null,{default:n(()=>[f("div",M,[l(w,{title:"变量报警记录",bordered:!1},{default:n(()=>[l(D,{type:"dataAlarmRerocrd",onSearch:k}),l(b,{class:"kd-small-table mt20",pagination:!1,"row-key":"id",bordered:!1,data:t.info.list,columns:[{title:"ID",dataIndex:"id",width:80},{title:"设备名称",dataIndex:"name"},{title:"触发器名称",dataIndex:"trigger_name"},{title:"触发器类型",slotName:"trigger_type"},{title:"从机名称",dataIndex:"subordinate_name"},{title:"变量",dataIndex:"variable_name"},{title:"当前值",dataIndex:"value"},{title:"触发条件",slotName:"trigger_con",width:160},{title:"报警时间",dataIndex:"create_time",width:160},{title:"报警状态",slotName:"is_warning"},{title:"处理状态",slotName:"status"},{title:"操作",slotName:"action",fixed:"right",width:130}],loading:t.loading,scroll:{x:1400}},{trigger_type:n(({record:a})=>[a.trigger_type===1?(s(),_("span",$,"设备")):h("",!0)]),trigger_con:n(({record:a})=>[a.trigger_condition?(s(),_("div",j,[l(o,{content:a.trigger_condition},{default:n(()=>[f("div",z,C(a.trigger_condition),1)]),_:2},1032,["content"])])):(s(),_("div",E," - "))]),is_warning:n(({record:a})=>[a.is_warning===0?(s(),_("span",L,"正常")):(s(),_("span",T,"报警"))]),status:n(({record:a})=>[a.status===0?(s(),_("span",q,"未处理")):(s(),_("span",F,"已处理"))]),action:n(({record:a})=>[l(m,{content:"确认删除报警记录吗？",onOk:N=>x(a.id)},{default:n(()=>[l(e,{type:"text",class:"ml-10",size:"mini"},{default:n(()=>i[0]||(i[0]=[u("删除")])),_:1,__:[0]})]),_:2},1032,["onOk"]),l(m,{content:"确认已处理了吗？",onOk:N=>v(a.id)},{default:n(()=>[a.status!==1?(s(),p(e,{key:0,type:"text",size:"mini"},{default:n(()=>i[1]||(i[1]=[u("处理")])),_:1,__:[1]})):h("",!0)]),_:2},1032,["onOk"])]),_:1},8,["data","loading"]),l(y,{"page-data":t.info,event:c},null,8,["page-data"])]),_:1})])]),_:1})}}},U=R(G,[["__scopeId","data-v-0e170b59"]]);export{U as default};
