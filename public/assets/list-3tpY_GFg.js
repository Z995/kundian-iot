import{s as h,v as I,r as N,d as s,c as O,e as A,o as g,b as a,w as n,l as v,M as x,j as R,a as $,f as p}from"./index-B09Km9Qy.js";const C="/admin/user/";function q(f){return h({url:`${C}getAdminList`,method:"get",params:f})}function L(f){return h({url:`${C}saveAdmin`,method:"post",data:f})}function M(f){return h({url:`${C}delAdmin`,method:"post",data:f})}const S={key:0},z={__name:"KdAccountAdd",emits:["success"],setup(f,{expose:k,emit:t}){const r=t,_=I(),l=N({show:!1,form:{id:0,name:"",phone:"",password:"",status:1}});function b(e){l.show=!0,l.form={id:e?e.id:0,name:e?e.name:"",phone:e?e.phone:"",password:"",status:e?parseInt(e.status):1}}async function u(){if(await _.value.validate())return!1;let o=JSON.parse(JSON.stringify(l.form));o.id||delete o.id;let i=await L(o);return i.code===200?(x.success("保存成功"),r("success"),!0):(x.error(i.msg),!1)}return k({show:b}),(e,o)=>{const i=s("a-input"),c=s("a-form-item"),w=s("a-switch"),V=s("a-form"),y=s("a-drawer");return l.show?(g(),O("div",S,[a(y,{title:"新增用户",visible:l.show,"onUpdate:visible":o[4]||(o[4]=d=>l.show=d),"on-before-ok":u,width:"800px"},{default:n(()=>[a(V,{model:l.form,ref_key:"formRef",ref:_,"label-col-props":{flex:"120px"},"wrapper-col-props":{flex:1}},{default:n(()=>[a(c,{label:"用户名",field:"name",rules:[{required:!0,message:"用户名必填"}]},{default:n(()=>[a(i,{modelValue:l.form.name,"onUpdate:modelValue":o[0]||(o[0]=d=>l.form.name=d),placeholder:"请输入用户名",class:"w500"},null,8,["modelValue"])]),_:1}),a(c,{label:"登录账号",field:"phone",rules:[{required:!0,message:"登录账号必填"}]},{default:n(()=>[a(i,{modelValue:l.form.phone,"onUpdate:modelValue":o[1]||(o[1]=d=>l.form.phone=d),placeholder:"请输入登录账号/手机号",class:"w500"},null,8,["modelValue"])]),_:1}),l.form.id?A("",!0):(g(),v(c,{key:0,label:"登陆密码",field:"password",rules:[{required:!0,message:"登陆密码必填"}]},{default:n(()=>[a(i,{modelValue:l.form.password,"onUpdate:modelValue":o[2]||(o[2]=d=>l.form.password=d),placeholder:"请输入登陆密码",class:"w500"},null,8,["modelValue"])]),_:1})),a(c,{label:"状态"},{default:n(()=>[a(w,{modelValue:l.form.status,"onUpdate:modelValue":o[3]||(o[3]=d=>l.form.status=d),"checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])):A("",!0)}}},F={class:"kd-content"},j={__name:"list",setup(f){const k=I(),t=N({loading:!1,search:{name:""},info:{list:[],page:1,limit:10,count:0}});R(()=>{r(1,10)});function r(u,e){t.info.page=u||t.info.page,t.info.limit=e||t.info.limit;let o={page:t.info.page,limit:t.info.limit};t.search.name&&(o.key=t.search.name),t.loading=!0,q(o).then(i=>{t.loading=!1,t.info.list=i.data.list,t.info.count=i.data.count}).catch(()=>{t.loading=!1})}function _(u){k.value.show(u)}function l(){t.search={},r(1,t.info.limit)}function b(u){M({id:u}).then(e=>{if(e.code===200){x.success("删除成功"),r();return}x.error(e.msg)})}return(u,e)=>{const o=s("a-button"),i=s("a-input"),c=s("a-space"),w=s("a-tag"),V=s("a-popconfirm"),y=s("a-table"),d=s("kd-pager"),D=s("a-card"),U=s("kd-page-box");return g(),v(U,null,{default:n(()=>[$("div",F,[a(D,{title:"用户列表",bordered:!1},{extra:n(()=>[a(o,{type:"primary",onClick:e[0]||(e[0]=m=>_(null))},{default:n(()=>e[3]||(e[3]=[$("i",{class:"ri-add-line"},null,-1),p("添加用户 ")])),_:1,__:[3]})]),default:n(()=>[a(c,null,{default:n(()=>[a(i,{modelValue:t.search.name,"onUpdate:modelValue":e[1]||(e[1]=m=>t.search.name=m),placeholder:"用户姓名，手机号或登录账户",class:"w300"},null,8,["modelValue"]),a(o,{type:"primary",loading:t.loading,onClick:e[2]||(e[2]=m=>r(1,t.info.limit))},{default:n(()=>e[4]||(e[4]=[p("查询")])),_:1,__:[4]},8,["loading"]),a(o,{onClick:l},{default:n(()=>e[5]||(e[5]=[p("重置")])),_:1,__:[5]})]),_:1}),a(y,{class:"kd-small-table mt20",pagination:!1,"row-key":"id",data:t.info.list,loading:t.loading,bordered:!1,columns:[{title:"ID",dataIndex:"id",width:80},{title:"用户姓名",dataIndex:"name"},{title:"登录账号",dataIndex:"phone"},{title:"设备数量",dataIndex:"device_count"},{title:"网关数量",dataIndex:"gateway_count"},{title:"状态",slotName:"status"},{title:"注册时间",dataIndex:"create_time"},{title:"操作",slotName:"action"}]},{status:n(({record:m})=>[m.status==1?(g(),v(w,{key:0,color:"#00CC66"},{default:n(()=>e[6]||(e[6]=[p("启用")])),_:1,__:[6]})):(g(),v(w,{key:1,color:"#FF9933"},{default:n(()=>e[7]||(e[7]=[p("禁用")])),_:1,__:[7]}))]),action:n(({record:m})=>[a(o,{type:"text",size:"mini",class:"ml-10",onClick:B=>_(m)},{default:n(()=>e[8]||(e[8]=[p("编辑")])),_:2,__:[8]},1032,["onClick"]),a(V,{content:"确认删除用户吗?",onOk:B=>b(m.id)},{default:n(()=>[a(o,{type:"text",size:"mini"},{default:n(()=>e[9]||(e[9]=[p("删除")])),_:1,__:[9]})]),_:2},1032,["onOk"])]),_:1},8,["data","loading"]),a(d,{"page-data":t.info,event:r},null,8,["page-data"])]),_:1})]),a(z,{ref_key:"addRef",ref:k,onSuccess:r},null,512)]),_:1})}}};export{j as default};
