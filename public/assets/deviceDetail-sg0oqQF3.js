import{u as T,f as ee,a as te,b as ae}from"./kdDevice-C_HdGTFt.js";import{v as j,r as A,d,c as f,e as E,o as c,b as i,w as o,M as k,_ as se,y as le,x as ie,z as oe,j as de,l as R,a,t as u,F,k as K,f as v,n as O,q as ne}from"./index-B09Km9Qy.js";import{K as ue}from"./KdMarkerAddress-kfqaZ62o.js";import{c as _e}from"./constantData-BoRWJogH.js";import"./TianDiMap-CZQsJKr7.js";const ce="/static/img/device/device-model.png",ve={key:0},re={__name:"CqkdUpdateDataValue",emits:["success"],setup(G,{expose:D,emit:x}){const y=j(),t=x,n=A({show:!1,value:"",variable_id:""});function $(_){n.show=!0,n.value=_.value,n.variable_id=_.id}async function U(){if(await y.value.validate())return!1;let p={variable_id:n.variable_id,value:n.value},g=await T(p);return g.code===200?(k.success("变量值修改成功"),t("success"),!0):(k.error(g.msg),!1)}return D({show:$}),(_,p)=>{const g=d("a-input"),l=d("a-form-item"),e=d("a-form"),r=d("a-modal");return n.show?(c(),f("div",ve,[i(r,{visible:n.show,"onUpdate:visible":p[1]||(p[1]=m=>n.show=m),width:"500px",title:"修改变量值","on-before-ok":U},{default:o(()=>[i(e,{ref_key:"formRef",ref:y,model:n,"label-col-props":{flex:"100px"},"wrapper-col-props":{flex:1}},{default:o(()=>[i(l,{label:"变量值",rules:[{required:!0,message:"请输入变量值"}]},{default:o(()=>[i(g,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=m=>n.value=m),placeholder:"请输入变量值"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])):E("",!0)}}},me={class:"kd-content"},fe={class:"device-basic flex"},pe={class:"device-basic-left flex mt5"},be={class:"db-info"},ge={class:"db-info-name fb"},ke={class:"db-info-num mt10"},ye={class:"db-info-desc"},Ve={class:"db-info-desc-item flex"},we={class:"db-value"},xe={class:"db-info-desc-item flex"},he={class:"db-value"},Ce={class:"db-info-desc-item flex"},De={class:"db-value"},$e={class:"db-info-desc-item flex"},Ue={class:"db-value"},Ie={class:"tag-box flex"},Ne={class:"db-info-desc-item flex"},Se={class:"db-value"},qe={key:0,class:"desc-map mt5"},Le={class:"device-data"},ze={class:"dd-slave flex mt10 mb10"},Be=["onClick"],Me={key:0},Re={key:1},Fe={class:"data-value"},Ke={key:0},Oe={key:1},Te=["onClick"],je={__name:"deviceDetail",setup(G){const D=le(),x=ie().query,y=j(),t=A({loading:!1,slave_id:0,slaveList:[],data:{loading:!1,list:[],search:{name:"",type:null}}});oe(()=>D.state.collectInfo,l=>{for(var e=0;e<t.data.list.length;e++)if(t.data.list[e].id===l.data.variable_id){t.data.list[e].value=l.data.value+"",t.data.list[e].update_time=l.data.date;break}}),de(async()=>{t.loading=!0,await n(),await _(0)});async function n(){let l=await ee({id:x.id});t.loading=!1,l.code===200&&(t.info=l.data,t.slaveList=t.info.subordinate)}const $=l=>y.value.show({id:l.id,value:l.value});function U(l){ae({variable_id:l}).then(e=>{if(e.code===200){k.success("采集成功"),_(t.slave_id);return}k.error(e.msg)})}function _(l){t.slave_id=l,t.data.loading=!0;let{name:e,type:r}=t.data.search,m=l?{subordinate_id:l}:{device_id:x.id};e&&(m.name=e),r&&(m.type=r),te(m).then(V=>{t.data.loading=!1,t.data.list=V.data.list}).catch(()=>{t.data.loading=!1})}function p(){t.data.search={name:"",type:null},_(t.slave_id)}function g(l){let e={variable_id:l.id,value:l.value};T(e).then(r=>{if(r.code===200){k.success("变量值修改成功");return}k.error(r.msg)})}return(l,e)=>{const r=d("kd-back"),m=d("a-tag"),V=d("a-option"),H=d("a-select"),J=d("a-input"),h=d("a-button"),P=d("a-space"),Q=d("a-switch"),W=d("router-link"),X=d("a-popconfirm"),Y=d("a-table"),Z=d("kd-page-box");return c(),R(Z,{loading:t.loading},{default:o(()=>{var I,N,S,q,L,z,B,M;return[a("div",me,[i(r,{title:"设备详情"}),a("div",fe,[a("div",null,[e[11]||(e[11]=a("div",{class:"fb"},"设备信息",-1)),a("div",pe,[e[10]||(e[10]=a("img",{src:ce,alt:"",class:"gateway-icon"},null,-1)),a("div",be,[a("div",ge,u((I=t.info)==null?void 0:I.name),1),a("div",ke,u((N=t.info)==null?void 0:N.code),1),a("div",ye,[a("div",Ve,[e[5]||(e[5]=a("div",{class:"db-title"},"设备模板：",-1)),a("div",we,u(((q=(S=t.info)==null?void 0:S.template)==null?void 0:q.name)||"-"),1)]),a("div",xe,[e[6]||(e[6]=a("div",{class:"db-title"},"设备网关：",-1)),a("div",he,u(((L=t.info)==null?void 0:L.gateway)||"-"),1)]),a("div",Ce,[e[7]||(e[7]=a("div",{class:"db-title"},"设备地址：",-1)),a("div",De,u(((z=t.info)==null?void 0:z.address)||"-"),1)]),a("div",$e,[e[8]||(e[8]=a("div",{class:"db-title"},"设备标签：",-1)),a("div",Ue,[a("div",Ie,[(c(!0),f(F,null,K((B=t.info)==null?void 0:B.label,(s,b)=>(c(),R(m,{color:"blue",key:b},{default:o(()=>[v(u(s.name),1)]),_:2},1024))),128))])])]),a("div",Ne,[e[9]||(e[9]=a("div",{class:"db-title"},"设备描述：",-1)),a("div",Se,u(((M=t.info)==null?void 0:M.describe)||"-"),1)])])])])]),a("div",null,[e[12]||(e[12]=a("div",{class:"fb"},"设备地图",-1)),t.info?(c(),f("div",qe,[i(ue,{longitude:t.info.longitude,latitude:t.info.latitude},null,8,["longitude","latitude"])])):E("",!0)])]),a("div",Le,[e[20]||(e[20]=a("div",{class:"fb"},"变量概况",-1)),a("div",ze,[a("div",{class:O(["dd-slave-item",{active:t.slave_id===0}]),onClick:e[0]||(e[0]=s=>_(0))}," 全部 ",2),(c(!0),f(F,null,K(t.slaveList,(s,b)=>{var w;return c(),f("div",{class:O(["dd-slave-item",{active:t.slave_id===s.id}]),key:b,onClick:C=>_(s.id)},u((w=s.subordinate)==null?void 0:w.name),11,Be)}),128))]),i(P,null,{default:o(()=>[i(H,{placeholder:"全部变量","allow-clear":"",class:"w160",modelValue:t.data.search.type,"onUpdate:modelValue":e[1]||(e[1]=s=>t.data.search.type=s)},{default:o(()=>[i(V,{value:1},{default:o(()=>e[13]||(e[13]=[v("直采变量")])),_:1,__:[13]}),i(V,{value:2},{default:o(()=>e[14]||(e[14]=[v("运算型变量")])),_:1,__:[14]}),i(V,{value:3},{default:o(()=>e[15]||(e[15]=[v("录入型变量")])),_:1,__:[15]})]),_:1},8,["modelValue"]),i(J,{placeholder:"请输入变量名称",modelValue:t.data.search.name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.data.search.name=s),class:"w240"},null,8,["modelValue"]),i(h,{type:"primary",onClick:e[3]||(e[3]=s=>_(t.slave_id))},{default:o(()=>e[16]||(e[16]=[v("查询")])),_:1,__:[16]}),i(h,{onClick:p},{default:o(()=>e[17]||(e[17]=[v("重置")])),_:1,__:[17]})]),_:1}),i(Y,{class:"kd-small-table mt10",bordered:!1,"row-key":"id",data:t.data.list,columns:[{title:"变量ID",dataIndex:"id"},{title:"变量名称",dataIndex:"name"},{title:"变量类型",slotName:"type"},{title:"更新时间",dataIndex:"update_time"},{title:"当前值",slotName:"value"},{title:"操作",slotName:"action",width:200}],loading:t.data.loading},{type:o(({record:s})=>[v(u(ne(_e).dataType[s.type]),1)]),value:o(({record:s})=>{var b,w;return[s.templateVariable.data_format===33?(c(),f("div",Me,[i(Q,{modelValue:s.value,"onUpdate:modelValue":C=>s.value=C,"checked-value":"1","unchecked-value":"0",onChange:C=>g(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):(c(),f("div",Re,[a("div",Fe,[s.templateVariable.read_write_mode===1?(c(),f("span",Ke,u(s.value)+" "+u((b=s.templateVariable)==null?void 0:b.unit),1)):(c(),f("span",Oe,[v(u(s.value)+u((w=s.templateVariable)==null?void 0:w.unit)+" ",1),a("i",{class:"ri-edit-line kd-link f20 ml5",onClick:C=>$(s)},null,8,Te)]))])]))]}),action:o(({record:s})=>[i(W,{to:{path:"/statistics/history",query:{id:s.id,device_id:s.device_id,slave_id:s.subordinate_id}}},{default:o(()=>[i(h,{type:"text",size:"mini",class:"ml-10"},{default:o(()=>e[18]||(e[18]=[v("历史查询")])),_:1,__:[18]})]),_:2},1032,["to"]),i(X,{content:"您将主动采集变量，是否继续?",onOk:b=>U(s.id)},{default:o(()=>[i(h,{type:"text",size:"mini"},{default:o(()=>e[19]||(e[19]=[v("主动采集")])),_:1,__:[19]})]),_:2},1032,["onOk"])]),_:1},8,["data","loading"])])]),i(re,{ref_key:"updateValue",ref:y,onSuccess:e[4]||(e[4]=s=>_(t.slave_id))},null,512)]}),_:1},8,["loading"])}}},Pe=se(je,[["__scopeId","data-v-7749b88b"]]);export{Pe as default};
