import{k as B}from"./kdStatistics-D113n_mW.js";import{g as v}from"./kdDevice-BExDw8cT.js";import{r as L,j as N,p as u,w as o,d as n,o as r,a as k,b as d,c as C,F as Y,l as M,f as m,t as x}from"./index-BIwpTUVt.js";const F={class:"kd-content"},$={__name:"deviceOnlineRecord",setup(H){const e=L({loading:!1,search:{device_id:null,time:[]},info:{page:1,limit:10,count:0,list:[]},device:{page:1,key:"",list:[]},selectId:[]});N(()=>{f(1),p(1,10)});function p(l,t){e.info.page=l||e.info.page,e.info.limit=t||e.info.limit;let i={page:e.info.page,limit:e.info.limit},{device_id:_,time:s}=e.search;_&&(i.device_id=_),s&&s.length&&(i.start_time=s[0],i.end_time=s[1]),e.loading=!0,B(i).then(c=>{e.loading=!1,e.info.list=c.data.list||[],e.info.count=c.data.count||0}).catch(()=>{e.loading=!1})}function b(l){e.device.key=l,e.device.page=1,v({page:1,limit:30,name:l}).then(i=>{e.device.list=i.data.list})}function f(l){e.device.page=1;let t={page:l,limit:30};e.device.key&&(t.name=e.device.key),v(t).then(i=>{l===1?e.device.list=i.data.list:e.device.list=e.device.list.concat(i.data.list)})}function y(){e.search={device_id:null,time:[]},p(1,e.info.limit)}return(l,t)=>{const i=n("a-option"),_=n("a-select"),s=n("a-range-picker"),c=n("a-button"),D=n("a-space"),g=n("a-tag"),w=n("a-table"),V=n("kd-pager"),I=n("a-card"),h=n("kd-page-box");return r(),u(h,null,{default:o(()=>[k("div",F,[d(I,{title:"设备上下线",bordered:!1},{default:o(()=>[d(D,null,{default:o(()=>[d(_,{class:"w160",placeholder:"请选择设备.",onSearch:b,modelValue:e.search.device_id,"onUpdate:modelValue":t[0]||(t[0]=a=>e.search.device_id=a),"filter-option":!1,"allow-search":"","allow-clear":"",onDropdownReachBottom:t[1]||(t[1]=a=>f(e.device.page+1))},{default:o(()=>[(r(!0),C(Y,null,M(e.device.list,(a,O)=>(r(),u(i,{value:a.id,key:a.id},{default:o(()=>[m(x(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),d(s,{class:"w340","show-time":"",format:"YYYY-MM-DD HH:mm",modelValue:e.search.time,"onUpdate:modelValue":t[2]||(t[2]=a=>e.search.time=a)},null,8,["modelValue"]),d(c,{type:"primary",onClick:t[3]||(t[3]=a=>p(1,e.info.limit))},{default:o(()=>t[4]||(t[4]=[m("查询")])),_:1,__:[4]}),d(c,{onClick:y},{default:o(()=>t[5]||(t[5]=[m("重置")])),_:1,__:[5]})]),_:1}),d(w,{class:"kd-small-table mt20",pagination:!1,"row-key":"id",bordered:!1,data:e.info.list,columns:[{title:"ID",dataIndex:"id"},{title:"设备名称",dataIndex:"name"},{title:"设备编号",dataIndex:"code"},{title:"时间",dataIndex:"create_time"},{title:"状态",slotName:"status"},{title:"下线原因",slotName:"reason"}],loading:e.loading},{status:o(({record:a})=>[a.status===1?(r(),u(g,{key:0,color:"green"},{default:o(()=>t[6]||(t[6]=[m("上线")])),_:1,__:[6]})):(r(),u(g,{key:1,color:"orangered"},{default:o(()=>t[7]||(t[7]=[m("下线")])),_:1,__:[7]}))]),reason:o(({record:a})=>[k("span",null,x(a.reason||"-"),1)]),_:1},8,["data","loading"]),d(V,{"page-data":e.info,event:p},null,8,["page-data"])]),_:1})])]),_:1})}}};export{$ as default};
