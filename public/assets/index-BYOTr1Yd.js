import{B as $,J as K,K as G,E as q,L as w,u as m,_ as H,i as J,r as z,d as E,c as M,o as _,a as u,e as T,b as k,w as P,f as Q,p as X,F as Y,l as Z,t as O,H as ee,M as te}from"./index-whL21Ijk.js";import{u as oe}from"./TianDiMap-BTIHgNCG.js";function se(s){return K()?(G(s),!0):!1}const F=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ne=Object.prototype.toString,le=s=>ne.call(s)==="[object Object]",b=()=>{},ae=ie();function ie(){var s,d;return F&&((s=window==null?void 0:window.navigator)==null?void 0:s.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((d=window==null?void 0:window.navigator)==null?void 0:d.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function B(s){return Array.isArray(s)?s:[s]}function re(s,d,n){return $(s,d,{...n,immediate:!0})}const j=F?window:void 0;function C(s){var d;const n=w(s);return(d=n==null?void 0:n.$el)!=null?d:n}function I(...s){const d=[],n=()=>{d.forEach(i=>i()),d.length=0},p=(i,a,c,r)=>(i.addEventListener(a,c,r),()=>i.removeEventListener(a,c,r)),h=q(()=>{const i=B(w(s[0])).filter(a=>a!=null);return i.every(a=>typeof a!="string")?i:void 0}),y=re(()=>{var i,a;return[(a=(i=h.value)==null?void 0:i.map(c=>C(c)))!=null?a:[j].filter(c=>c!=null),B(w(h.value?s[1]:s[0])),B(m(h.value?s[2]:s[1])),w(h.value?s[3]:s[2])]},([i,a,c,r])=>{if(n(),!(i!=null&&i.length)||!(a!=null&&a.length)||!(c!=null&&c.length))return;const S=le(r)?{...r}:r;d.push(...i.flatMap(l=>a.flatMap(g=>c.map(x=>p(l,g,x,S)))))},{flush:"post"}),L=()=>{y(),n()};return se(n),L}let R=!1;function de(s,d,n={}){const{window:p=j,ignore:h=[],capture:y=!0,detectIframe:L=!1,controls:i=!1}=n;if(!p)return i?{stop:b,cancel:b,trigger:b}:b;if(ae&&!R){R=!0;const o={passive:!0};Array.from(p.document.body.children).forEach(t=>t.addEventListener("click",b,o)),p.document.documentElement.addEventListener("click",b,o)}let a=!0;const c=o=>w(h).some(t=>{if(typeof t=="string")return Array.from(p.document.querySelectorAll(t)).some(e=>e===o.target||o.composedPath().includes(e));{const e=C(t);return e&&(o.target===e||o.composedPath().includes(e))}});function r(o){const t=w(o);return t&&t.$.subTree.shapeFlag===16}function S(o,t){const e=w(o),v=e.$.subTree&&e.$.subTree.children;return v==null||!Array.isArray(v)?!1:v.some(V=>V.el===t.target||t.composedPath().includes(V.el))}const l=o=>{const t=C(s);if(o.target!=null&&!(!(t instanceof Element)&&r(s)&&S(s,o))&&!(!t||t===o.target||o.composedPath().includes(t))){if("detail"in o&&o.detail===0&&(a=!c(o)),!a){a=!0;return}d(o)}};let g=!1;const x=[I(p,"click",o=>{g||(g=!0,setTimeout(()=>{g=!1},0),l(o))},{passive:!0,capture:y}),I(p,"pointerdown",o=>{const t=C(s);a=!c(o)&&!!(t&&!o.composedPath().includes(t))},{passive:!0}),L&&I(p,"blur",o=>{setTimeout(()=>{var t;const e=C(s);((t=p.document.activeElement)==null?void 0:t.tagName)==="IFRAME"&&!(e!=null&&e.contains(p.document.activeElement))&&d(o)},0)},{passive:!0})].filter(Boolean),A=()=>x.forEach(o=>o());return i?{stop:A,cancel:()=>{a=!1},trigger:o=>{a=!0,l(o),a=!1}}:A}const ce={style:{width:"100%"}},ue={class:"add-input"},pe={key:0},fe={class:"map-box"},me={class:"search-box"},he={class:"input-box flex"},ge=["onClick"],ve={class:"address-name"},we={class:"address-area"},ye={class:"flex-c mt10"},_e={class:"w600 ml10"},ke={class:"flex-c mt10"},be={class:"w600 ml10"},Le={__name:"index",props:{lngLat:{type:Array,default:[]},address:{type:String,default:""}},emits:["success"],setup(s,{emit:d}){const{tianState:n,initMap:p,createSearchLocation:h,doSearch:y,setMapCenter:L,addMarker:i,getCurrentLocation:a}=oe(),c=J(),r=s,S=d,l=z({show:!1,keyword:"",address:"",location:[]});$(()=>r.lngLat,()=>{l.address=r.address||"",l.location=r.lngLat&&r.lngLat.length?r.lngLat:[116.40769,39.89945],l.address||(l.address=r.lngLat.join(","))},{deep:!0,immediate:!0}),de(c,t=>{n.search.show=!1});function g(){l.show=!0,l.address=r.address||"",l.location=r.lngLat&&r.lngLat.length?r.lngLat:[116.40769,39.89945],ee(()=>{let t=l.location||[];p({el:"selectMapBox",center:t,isClick:!0},()=>{a(),h(),t.length&&i(t[0],t[1],{draggable:!0,isResolution:!0})})})}function x(t){if(n.search.show=!1,t.lonlat){let e=t.lonlat.split(",");L(e[0],e[1]),i(e[0],e[1],{draggable:!0,isResolution:!0})}}function A(){n.search.list.length&&(n.search.show=!0)}async function o(){let{location:t,address:e}=n.selectLocation;if(!t.length||!e)return te.warning("请选择地址"),!1;l.address=e,l.location=t,S("success",{location:t,address:e})}return(t,e)=>{const v=E("a-input"),V=E("a-button"),N=E("kd-empty"),W=E("a-spin"),D=E("a-modal");return _(),M("div",ce,[u("div",ue,[k(v,{placeholder:"请选择地址",disabled:"",modelValue:l.address,"onUpdate:modelValue":e[0]||(e[0]=f=>l.address=f)},{append:P(()=>[u("span",{class:"kd-link",onClick:g},"选择地址")]),_:1},8,["modelValue"])]),l.show?(_(),M("div",pe,[k(D,{title:"选择位置",visible:l.show,"onUpdate:visible":e[5]||(e[5]=f=>l.show=f),width:"1000px","on-before-ok":o},{default:P(()=>[u("div",fe,[u("div",me,[u("div",he,[k(v,{modelValue:l.keyword,"onUpdate:modelValue":e[1]||(e[1]=f=>l.keyword=f),placeholder:"请输入位置进行搜索",onPressEnter:e[2]||(e[2]=f=>m(y)(l.keyword)),onFocus:A},null,8,["modelValue"]),k(V,{type:"primary",class:"ml10",onClick:e[3]||(e[3]=f=>m(y)(l.keyword))},{default:P(()=>e[6]||(e[6]=[Q("搜索")])),_:1,__:[6]})]),k(W,{loading:m(n).search.loading,tip:"加载中..."},{default:P(()=>[m(n).search.loading||m(n).search.show?(_(),M("div",{key:0,class:"searchResult",ref_key:"resultRef",ref:c},[(_(!0),M(Y,null,Z(m(n).search.list,(f,U)=>(_(),M("div",{class:"address-item",key:U,onClick:Se=>x(f)},[e[7]||(e[7]=u("i",{class:"ri-search-2-line"},null,-1)),u("span",ve,O(f.name),1),u("span",we,O(f.address),1)],8,ge))),128)),m(n).search.list.length?T("",!0):(_(),X(N,{key:0}))],512)):T("",!0)]),_:1},8,["loading"])]),e[10]||(e[10]=u("div",{class:"map-box-container",id:"selectMapBox"},null,-1)),u("div",ye,[e[8]||(e[8]=u("div",null,"详情地址",-1)),u("div",_e,[k(v,{placeholder:"请选择地址",modelValue:m(n).selectLocation.address,"onUpdate:modelValue":e[4]||(e[4]=f=>m(n).selectLocation.address=f)},null,8,["modelValue"])])]),u("div",ke,[e[9]||(e[9]=u("div",null,"经 纬 度：",-1)),u("div",be,[u("span",null,O(m(n).selectLocation.location),1)])])])]),_:1},8,["visible"])])):T("",!0)])}}},Me=H(Le,[["__scopeId","data-v-2d812570"]]);export{Me as K};
