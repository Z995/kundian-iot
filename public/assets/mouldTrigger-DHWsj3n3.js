import{c as H}from"./constantData-BoRWJogH.js";import{c as P}from"./kdDevice-C_HdGTFt.js";import{b as G,c as Q,e as W,f as X}from"./kdTrigger-CLuLFXfz.js";import{v as R,r as F,d as c,c as p,e as v,o as d,b as t,w as i,l as D,F as U,k as $,f as k,t as _,q as Y,a as n,M as I,_ as Z,j as ee}from"./index-B09Km9Qy.js";const le={key:0},ae={key:0,class:"mt20"},te={key:1,class:"mt20"},ie={__name:"KdMouldTriggerAdd",emits:["success"],setup(K,{expose:M,emit:o}){const u=o,x=R(),e=F({show:!1,loading:!1,form:{id:0,name:"",template_id:null,template_subordinate_id:null,template_subordinate_variable_id:null,condition:"",condition_parameter:{A:"",B:""},dead_zone:"",is_alarm:0,alarm_push:"",resume_push:"",is_linkage:0,linkage_type:1,linkage_subordinate_id:null,linkage_subordinate_variable_id:null,control_type:1,number:""},rules:{template_subordinate_variable_id:[{required:!0,message:"设备变量必选"},{validator:(m,l)=>{!e.form.template_id||!e.form.template_subordinate_id||!e.form.template_subordinate_variable_id?l("设备模板变量必选"):l()}}],condition:[{required:!0,message:"触发条件必选"},{validator:(m,l)=>{e.form.condition?["2","6"].includes(e.form.condition)&&!e.form.condition_parameter.A?l("请输入A的值"):e.form.condition==="3"&&!e.form.condition_parameter.B?l("请输入B的值"):["4","5"].includes(e.form.condition)&&(!e.form.condition_parameter.B||!e.form.condition_parameter.A)?l("请输入A和B的值"):l():l("触发条件必选")}}],linkage_subordinate_variable_id:[{required:!0,message:"联动变量必选"},{validator:(m,l)=>{!e.form.linkage_subordinate_id||!e.form.linkage_subordinate_variable_id?l("联动变量必选"):l()}}]},deviceMould:[],slaveList:[],deviceData:[],linkDeviceData:[]});async function C(m){e.show=!0,P({page:1,limit:999}).then(r=>{e.deviceMould=r.data.list});let l=null;m&&(e.loading=!0,l=(await G({id:m})).data),e.form={id:m,name:l?l.name:"",template_id:l?l.template_id:null,template_subordinate_id:l?l.template_subordinate_id:null,template_subordinate_variable_id:l?l.template_subordinate_variable_id:null,condition:l?l.condition+"":"",condition_parameter:{A:l?l.condition_parameter.A:"",B:l?l.condition_parameter.B:""},dead_zone:l?l.dead_zone:"",resume_push:l?l.resume_push:"",alarm_push:l?l.alarm_push:"",is_linkage:l?l.is_linkage:0,is_alarm:l?l.is_alarm:0,linkage_type:l?l.linkage_type:1,linkage_subordinate_id:l?l.linkage_subordinate_id:null,linkage_subordinate_variable_id:l?l.linkage_subordinate_variable_id:null,control_type:l?l.control_type:1,number:l?l.number:""},e.loading=!1}function S(){var r;e.slaveList=[],e.deviceData=[],e.form.template_subordinate_id=null,e.form.template_subordinate_variable_id=null;let{template_id:m}=e.form,l=e.deviceMould.find(f=>f.id==m);l&&((r=l.subordinate)!=null&&r.length)&&(e.slaveList=l.subordinate,e.form.template_subordinate_id=e.slaveList[0].id,L())}function L(){var r;e.deviceData=[],e.form.template_subordinate_variable_id=null;let{template_subordinate_id:m}=e.form,l=e.slaveList.find(f=>f.id===m);l&&((r=l.variable)!=null&&r.length)&&(e.deviceData=l.variable,e.form.template_subordinate_variable_id=e.deviceData[0].id)}function b(){var r;e.linkDeviceData=[],e.form.linkage_subordinate_variable_id=null;let{linkage_subordinate_id:m}=e.form,l=e.slaveList.find(f=>f.id===m);l&&((r=l.variable)!=null&&r.length)&&(e.linkDeviceData=l.variable,e.form.linkage_subordinate_variable_id=e.linkDeviceData[0].id)}async function s(){if(await x.value.validate())return!1;let l=JSON.parse(JSON.stringify(e.form));l.id||delete l.id;let r=await Q(l);return r.code===200?(I.success("保存成功"),u("success"),!0):(I.error(r.msg),!1)}return M({show:C}),(m,l)=>{const r=c("a-input"),f=c("a-form-item"),V=c("a-option"),h=c("a-select"),B=c("a-space"),A=c("a-switch"),g=c("a-textarea"),w=c("a-radio"),N=c("a-radio-group"),T=c("a-form"),z=c("a-spin"),q=c("a-drawer");return e.show?(d(),p("div",le,[t(q,{title:"添加模板触发器",visible:e.show,"onUpdate:visible":l[17]||(l[17]=a=>e.show=a),"on-before-ok":s,width:"800px"},{default:i(()=>[t(z,{loading:e.loading,tip:"数据加载中..."},{default:i(()=>[e.show?(d(),D(T,{key:0,model:e.form,ref_key:"formRef",ref:x,"label-col-props":{flex:"130px"},"wrapper-col-props":{flex:1},rules:e.rules},{default:i(()=>[t(f,{label:"触发器名称",field:"name",rules:[{required:!0,message:"触发器名称必填"}]},{default:i(()=>[t(r,{modelValue:e.form.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.form.name=a),placeholder:"请输入触发器名称",class:"w500"},null,8,["modelValue"])]),_:1}),t(f,{label:"选择模板和变量",field:"template_subordinate_variable_id"},{default:i(()=>[t(B,null,{default:i(()=>[t(h,{placeholder:"请选择模板",class:"w160",modelValue:e.form.template_id,"onUpdate:modelValue":l[1]||(l[1]=a=>e.form.template_id=a),onChange:S},{default:i(()=>[(d(!0),p(U,null,$(e.deviceMould,(a,y)=>(d(),D(V,{key:y,value:a.id},{default:i(()=>[k(_(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(h,{placeholder:"请选择从机",class:"w160",modelValue:e.form.template_subordinate_id,"onUpdate:modelValue":l[2]||(l[2]=a=>e.form.template_subordinate_id=a),onChange:L},{default:i(()=>[(d(!0),p(U,null,$(e.slaveList,(a,y)=>(d(),D(V,{key:y,value:a.id},{default:i(()=>[k(_(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(h,{placeholder:"请选择变量",class:"w160",modelValue:e.form.template_subordinate_variable_id,"onUpdate:modelValue":l[3]||(l[3]=a=>e.form.template_subordinate_variable_id=a)},{default:i(()=>[(d(!0),p(U,null,$(e.deviceData,(a,y)=>(d(),D(V,{key:y,value:a.id},{default:i(()=>[k(_(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{label:"触发条件",field:"condition"},{default:i(()=>[t(B,null,{default:i(()=>[t(h,{modelValue:e.form.condition,"onUpdate:modelValue":l[4]||(l[4]=a=>e.form.condition=a),placeholder:"请选择触发条件",class:"w160"},{default:i(()=>[(d(!0),p(U,null,$(Y(H).triggerCondition,(a,y)=>(d(),D(V,{value:y},{default:i(()=>[k(_(a),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),["2","4","5","6"].includes(e.form.condition)?(d(),D(r,{key:0,placeholder:"请输入A的值",class:"w160",modelValue:e.form.condition_parameter.A,"onUpdate:modelValue":l[5]||(l[5]=a=>e.form.condition_parameter.A=a)},null,8,["modelValue"])):v("",!0),["3","4","5"].includes(e.form.condition)?(d(),D(r,{key:1,placeholder:"请输入B的值",class:"w160",modelValue:e.form.condition_parameter.B,"onUpdate:modelValue":l[6]||(l[6]=a=>e.form.condition_parameter.B=a)},null,8,["modelValue"])):v("",!0)]),_:1})]),_:1}),["2","3","4","5","6"].includes(e.form.condition)?(d(),D(f,{key:0,label:"报警死区"},{default:i(()=>[t(r,{placeholder:"请输入触发阈值",class:"w500",modelValue:e.form.dead_zone,"onUpdate:modelValue":l[7]||(l[7]=a=>e.form.dead_zone=a)},null,8,["modelValue"])]),_:1})):v("",!0),t(f,{label:"报警"},{default:i(()=>[t(A,{modelValue:e.form.is_alarm,"onUpdate:modelValue":l[8]||(l[8]=a=>e.form.is_alarm=a),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])]),_:1}),e.form.is_alarm===1?(d(),p(U,{key:1},[t(f,{label:"报警推送内容"},{default:i(()=>[t(g,{placeholder:"请输入报警推送内容",style:{height:"80px"},modelValue:e.form.alarm_push,"onUpdate:modelValue":l[9]||(l[9]=a=>e.form.alarm_push=a),"max-length":50,"allow-clear":"","show-word-limit":"",class:"w500"},null,8,["modelValue"])]),_:1}),t(f,{label:"恢复正常推送内容"},{default:i(()=>[t(g,{placeholder:"请输入恢复正常推送内容",style:{height:"80px"},modelValue:e.form.resume_push,"onUpdate:modelValue":l[10]||(l[10]=a=>e.form.resume_push=a),"max-length":50,"allow-clear":"","show-word-limit":"",class:"w500"},null,8,["modelValue"])]),_:1})],64)):v("",!0),t(f,{label:"联动"},{default:i(()=>[t(A,{modelValue:e.form.is_linkage,"onUpdate:modelValue":l[11]||(l[11]=a=>e.form.is_linkage=a),"checked-value":1,"unchecked-value":0,"checked-text":"联动","unchecked-text":"不联动"},null,8,["modelValue"])]),_:1}),e.form.is_linkage===1?(d(),p(U,{key:2},[t(f,{label:"联动类型",required:""},{default:i(()=>[t(N,{modelValue:e.form.linkage_type,"onUpdate:modelValue":l[12]||(l[12]=a=>e.form.linkage_type=a)},{default:i(()=>[t(w,{value:1},{default:i(()=>l[18]||(l[18]=[k("采集")])),_:1,__:[18]}),t(w,{value:2},{default:i(()=>l[19]||(l[19]=[k("控制")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"联动变量",field:"linkage_subordinate_variable_id"},{default:i(()=>[n("div",null,[t(B,null,{default:i(()=>[t(h,{placeholder:"请选择从机",class:"w160",modelValue:e.form.linkage_subordinate_id,"onUpdate:modelValue":l[13]||(l[13]=a=>e.form.linkage_subordinate_id=a),onChange:b},{default:i(()=>[(d(!0),p(U,null,$(e.slaveList,(a,y)=>(d(),D(V,{key:y,value:a.id},{default:i(()=>[k(_(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(h,{placeholder:"请选择变量",class:"w160",modelValue:e.form.linkage_subordinate_variable_id,"onUpdate:modelValue":l[14]||(l[14]=a=>e.form.linkage_subordinate_variable_id=a)},{default:i(()=>[(d(!0),p(U,null,$(e.linkDeviceData,(a,y)=>(d(),D(V,{key:y,value:a.id},{default:i(()=>[k(_(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.form.linkage_type===2?(d(),p("div",ae,[t(N,{modelValue:e.form.control_type,"onUpdate:modelValue":l[15]||(l[15]=a=>e.form.control_type=a)},{default:i(()=>[t(w,{value:1},{default:i(()=>l[20]||(l[20]=[k("手动下发")])),_:1,__:[20]}),t(w,{value:2},{default:i(()=>l[21]||(l[21]=[k("取报警值")])),_:1,__:[21]})]),_:1},8,["modelValue"])])):v("",!0),e.form.linkage_type===2&&e.form.control_type===1?(d(),p("div",te,[t(g,{placeholder:"请输入下发数据（十进制）",style:{height:"80px"},modelValue:e.form.number,"onUpdate:modelValue":l[16]||(l[16]=a=>e.form.number=a),"max-length":50,"allow-clear":"","show-word-limit":"",class:"w500"},null,8,["modelValue"])])):v("",!0)])]),_:1})],64)):v("",!0)]),_:1},8,["model","rules"])):v("",!0)]),_:1},8,["loading"])]),_:1},8,["visible"])])):v("",!0)}}},oe={key:0},ne={class:"info-box"},de={key:0,class:"info-box"},se={class:"info-item flex"},re={class:"ii-value"},ue={class:"info-item flex"},me={class:"ii-value"},_e={class:"info-item flex"},fe={class:"ii-value"},pe={key:0},ce={key:1},ve={key:2},ge={key:3},ke={key:4},be={key:5},Ve={key:6},ye={class:"info-item flex"},we={class:"ii-value"},xe={class:"info-item flex"},he={class:"ii-value"},De={class:"info-item flex"},Ue={class:"ii-value"},Be={class:"info-item flex"},Ae={class:"ii-value"},Me={class:"info-item flex"},Ce={class:"ii-value"},Le={class:"info-item flex"},$e={class:"ii-value"},Se={key:0},Ne={key:0,class:"info-item flex"},Te={class:"ii-value"},ze={__name:"KdMouldTriggerDetail",setup(K,{expose:M}){const o=F({show:!1,loading:!1,info:null});function u(x){o.show=!0,o.loading=!0,G({id:x}).then(e=>{o.loading=!1,o.info=e.data}).catch(()=>{o.loading=!1})}return M({show:u}),(x,e)=>{const C=c("a-switch"),S=c("a-spin"),L=c("a-modal");return o.show?(d(),p("div",oe,[t(L,{title:"模板触发器信息",visible:o.show,"onUpdate:visible":e[2]||(e[2]=b=>o.show=b),width:"600px",footer:null},{default:i(()=>[t(S,{loading:o.loading,tip:"数据加载中...",style:{width:"100%"}},{default:i(()=>{var b,s,m,l,r,f,V,h,B,A,g,w,N,T,z,q,a,y,J,j,E;return[n("div",ne,[o.info?(d(),p("div",de,[n("div",se,[e[3]||(e[3]=n("div",{class:"ii-title"},"触发器名称：",-1)),n("div",re,_(((b=o.info)==null?void 0:b.name)||""),1)]),n("div",ue,[e[4]||(e[4]=n("div",{class:"ii-title"},"模板和变量：",-1)),n("div",me,_(((m=(s=o.info)==null?void 0:s.template)==null?void 0:m.name)||"")+" - "+_(((r=(l=o.info)==null?void 0:l.templateSubordinate)==null?void 0:r.name)||"")+" - "+_(((V=(f=o.info)==null?void 0:f.templateSubordinateVariable)==null?void 0:V.name)||""),1)]),n("div",_e,[e[5]||(e[5]=n("div",{class:"ii-title"},"触发条件：",-1)),n("div",fe,[o.info.condition===0?(d(),p("span",pe,"开关OFF")):v("",!0),o.info.condition===1?(d(),p("span",ce,"开关ON")):v("",!0),o.info.condition===2?(d(),p("span",ve,"数值小于"+_((h=o.info)==null?void 0:h.condition_parameter.A),1)):v("",!0),o.info.condition===3?(d(),p("span",ge,"数值大于"+_((B=o.info)==null?void 0:B.condition_parameter.B),1)):v("",!0),o.info.condition===4?(d(),p("span",ke,"数值大于"+_((A=o.info)==null?void 0:A.condition_parameter.A)+"且小于"+_((g=o.info)==null?void 0:g.condition_parameter.B),1)):v("",!0),o.info.condition===5?(d(),p("span",be,"数值小于"+_((w=o.info)==null?void 0:w.condition_parameter.A)+"或大于"+_((N=o.info)==null?void 0:N.condition_parameter.B),1)):v("",!0),o.info.condition===6?(d(),p("span",Ve,"数值等于"+_((T=o.info)==null?void 0:T.condition_parameter.A),1)):v("",!0)])]),n("div",ye,[e[6]||(e[6]=n("div",{class:"ii-title"},"报警：",-1)),n("div",we,[t(C,{disabled:"",modelValue:o.info.is_alarm,"onUpdate:modelValue":e[0]||(e[0]=O=>o.info.is_alarm=O),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])])]),o.info.is_alarm===1?(d(),p(U,{key:0},[n("div",xe,[e[7]||(e[7]=n("div",{class:"ii-title"},"报警推送内容：",-1)),n("div",he,_((z=o.info)==null?void 0:z.alarm_push),1)]),n("div",De,[e[8]||(e[8]=n("div",{class:"ii-title"},"恢复正常推送内容：",-1)),n("div",Ue,_((q=o.info)==null?void 0:q.resume_push),1)])],64)):v("",!0),n("div",Be,[e[9]||(e[9]=n("div",{class:"ii-title"},"联动：",-1)),n("div",Ae,[t(C,{disabled:"",modelValue:o.info.is_linkage,"onUpdate:modelValue":e[1]||(e[1]=O=>o.info.is_linkage=O),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])])]),o.info.is_linkage===1?(d(),p(U,{key:1},[n("div",Me,[e[10]||(e[10]=n("div",{class:"ii-title"},"联动类型：",-1)),n("div",Ce,[n("span",null,_(o.info.linkage_type===1?"采集":"控制"),1)])]),n("div",Le,[e[11]||(e[11]=n("div",{class:"ii-title"},"联动变量：",-1)),n("div",$e,[k(_((a=o.info)==null?void 0:a.linkageSubordinate.name)+" - "+_((y=o.info)==null?void 0:y.linkageSubordinateVariableId.name)+" ",1),o.info.linkage_type===2?(d(),p("span",Se,"（"+_(((J=o.info)==null?void 0:J.control_type)===2?"手动下发":"取报警值")+"）",1)):v("",!0)])]),((j=o.info)==null?void 0:j.control_type)===2&&o.info.linkage_type===2?(d(),p("div",Ne,[e[12]||(e[12]=n("div",{class:"ii-title"},"下发数据：",-1)),n("div",Te,_((E=o.info)==null?void 0:E.number),1)])):v("",!0)],64)):v("",!0)])):v("",!0)])]}),_:1},8,["loading"])]),_:1},8,["visible"])])):v("",!0)}}},qe=Z(ze,[["__scopeId","data-v-8bd37938"]]),Ie={class:"kd-content"},Je={__name:"mouldTrigger",setup(K){const M=R(),o=R(),u=F({search:{name:"",template_name:""},loading:!1,info:{list:[],page:1,limit:10,count:0}});ee(()=>{x(1,10)});function x(b,s){u.info.page=b||u.info.page,u.info.limit=s||u.info.limit;let{name:m,template_name:l}=u.search,r={page:u.info.page,limit:u.info.limit};m&&(r.name=m),l&&(r.template_name=l),u.loading=!0,W(r).then(f=>{var V;u.loading=!1,u.info.list=f.data.list,u.info.count=((V=f.data)==null?void 0:V.count)||0}).catch(()=>{u.loading=!1})}function e(b){M.value.show(b)}function C(b){o.value.show(b)}function S(b){X({id:b}).then(s=>{if(s.code===200){I.success("删除成功"),x();return}I.error(s.msg)})}function L(){u.search={name:"",template_name:""},x(1,u.info.limit)}return(b,s)=>{const m=c("a-button"),l=c("a-space"),r=c("a-input"),f=c("a-popconfirm"),V=c("a-table"),h=c("kd-pager"),B=c("a-card"),A=c("kd-page-box");return d(),D(A,null,{default:i(()=>[n("div",Ie,[t(B,{title:"模板触发器",bordered:!1},{extra:i(()=>[t(l,null,{default:i(()=>[t(m,{type:"primary",onClick:s[0]||(s[0]=g=>e(null))},{default:i(()=>s[4]||(s[4]=[n("i",{class:"ri-add-line"},null,-1),k("添加触发器 ")])),_:1,__:[4]})]),_:1})]),default:i(()=>[t(l,null,{default:i(()=>[t(r,{modelValue:u.search.name,"onUpdate:modelValue":s[1]||(s[1]=g=>u.search.name=g),placeholder:"触发器名称",class:"w200"},null,8,["modelValue"]),t(r,{modelValue:u.search.template_name,"onUpdate:modelValue":s[2]||(s[2]=g=>u.search.template_name=g),placeholder:"模板名称",class:"w200"},null,8,["modelValue"]),t(m,{type:"primary",loading:u.loading,onClick:s[3]||(s[3]=g=>x(1,u.info.limit))},{default:i(()=>s[5]||(s[5]=[k("查询")])),_:1,__:[5]},8,["loading"]),t(m,{onClick:L},{default:i(()=>s[6]||(s[6]=[k("重置")])),_:1,__:[6]})]),_:1}),t(V,{class:"kd-small-table mt20",pagination:!1,"row-key":"id",data:u.info.list,loading:u.loading,bordered:!1,columns:[{title:"ID",dataIndex:"id",width:80},{title:"触发器名称",dataIndex:"name"},{title:"模板名称",slotName:"mould_name"},{title:"更新时间",dataIndex:"update_time"},{title:"操作",slotName:"action",width:180,fixed:"right"}],scroll:{x:1200}},{mould_name:i(({record:g})=>{var w;return[n("span",null,_(((w=g.template)==null?void 0:w.name)||"-"),1)]}),action:i(({record:g})=>[t(m,{type:"text",size:"mini",class:"ml-10",onClick:w=>C(g.id)},{default:i(()=>s[7]||(s[7]=[k("查看")])),_:2,__:[7]},1032,["onClick"]),t(m,{type:"text",size:"mini",class:"ml-10",onClick:w=>e(g.id)},{default:i(()=>s[8]||(s[8]=[k("编辑")])),_:2,__:[8]},1032,["onClick"]),t(f,{content:"确认触发器吗?",onOk:w=>S(g.id)},{default:i(()=>[t(m,{type:"text",size:"mini"},{default:i(()=>s[9]||(s[9]=[k("删除")])),_:1,__:[9]})]),_:2},1032,["onOk"])]),_:1},8,["data","loading"]),t(h,{"page-data":u.info,event:x},null,8,["page-data"])]),_:1})]),t(ie,{ref_key:"addRef",ref:M,onSuccess:x},null,512),t(qe,{ref_key:"detailRef",ref:o},null,512)]),_:1})}}};export{Je as default};
