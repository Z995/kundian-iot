import{x as b,r as R}from"./index-3_WCOcxA.js";function y(){let i=null,o=null;const u=b(),e=R({mapObj:null,localSearchObj:null,search:{list:[],show:!1,loading:!1},markerList:[],selectLocation:{marker:null,location:[],address:""},tk:u.state.tkToken});function f(a,t){const r=new T.Map(a.el);let[l,n]=a!=null&&a.center&&a.center.length?a.center:[116.40769,39.89945];r.centerAndZoom(new T.LngLat(l,n),15),e.mapObj=r,a!=null&&a.isClick&&r.on("click",c=>{m(c.lnglat.lng,c.lnglat.lat,{draggable:!0,isResolution:!0}),s(c.lnglat.lng,c.lnglat.lat)}),a.isSatellite&&S(),typeof t=="function"&&t(!0)}function S(a){O();let t="https://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk="+e.tk,r=`https://t2.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&tk=${e.tk}&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}`;i=new T.TileLayer(t,{minZoom:1,maxZoom:18,zIndex:1}),o=new T.TileLayer(r,{minZoom:1,maxZoom:18,zIndex:2}),e.mapObj.addLayer(i),e.mapObj.addLayer(o)}function h(){var a=new T.Geolocation;a.getCurrentPosition(function(t){this.getStatus()==0&&e.mapObj.centerAndZoom(t.lnglat,15),this.getStatus()==1&&e.mapObj.centerAndZoom(t.lnglat,t.level)})}function k(){try{var a={pageCapacity:10,onSearchComplete:function(r){switch(e.search.loading=!1,e.search.show=!0,parseInt(r.getResultType())){case 1:e.search.list=r.getPois();break;case 2:break;case 3:let l=r.getArea();l.name&&L(l.name,4);break;case 4:e.search.list=r.getSuggests();break;case 5:break}}};e.localSearchObj=new T.LocalSearch(e.mapObj,a)}catch(t){console.log("创建搜索对象报错",t)}}function L(a,t=null){e.search.loading=!0,t?e.localSearchObj.search(a,t):e.localSearchObj.search(a)}function g(a,t){e.mapObj.centerAndZoom(new T.LngLat(a,t),15)}function m(a,t,r){d();var l=new T.Marker(new T.LngLat(a,t),{draggable:r.draggable||!1});e.mapObj.addOverLay(l),e.selectLocation.marker=l,e.selectLocation.location=[a,t],g(a,t),r!=null&&r.draggable&&l.addEventListener("dragend",n=>{e.selectLocation.location=[n.lnglat.lng,n.lnglat.lat],r!=null&&r.isResolution&&s(n.lnglat.lng,n.lnglat.lat)}),r!=null&&r.isResolution&&s(a,t)}function d(){e.selectLocation.marker&&(e.mapObj.removeOverLay(e.selectLocation.marker),e.selectLocation.marker=null)}function s(a,t){new T.Geocoder().getLocation(new T.LngLat(a,t),l=>{e.selectLocation.address=l.getAddress()})}function O(){i&&e.mapObj.removeLayer(i),o&&e.mapObj.removeLayer(o)}function E(a,{isClick:t=!1},r){if(e.markerList.length){for(let l=0;l<e.markerList.length;l++)e.mapObj.removeOverLay(e.markerList[l]);e.markerList=[]}a.forEach(l=>{let n=new T.Marker(new T.LngLat(l.longitude,l.latitude));e.mapObj.addOverLay(n),e.markerList.push(n),t&&n.on("click",function(c){typeof r=="function"&&r(l)})})}return{tianState:e,initMap:f,createSearchLocation:k,doSearch:L,getCurrentLocation:h,setMapCenter:g,addMarker:m,removeMarker:d,addBatchMarker:E}}export{y as u};
